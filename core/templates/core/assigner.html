{% extends "base.html" %}
{% load static %}
{% load custom_filters %}

{% block title %}Assigner Maxima - {{ classe.nom }}{% endblock %}

{% block content %}
<div class="min-h-screen bg-gray-900 text-white py-10 px-4">

    <h1 class="text-3xl font-bold text-center text-indigo-400 mb-8">
        Assigner un Maxima au Semestre Total de la classe : {{ classe.nom }}
    </h1>

    <div class="max-w-xl mx-auto bg-gray-800 p-6 rounded-lg shadow-lg">
        <h2 class="text-xl text-green-400 mb-4 font-semibold">S√©lection</h2>

        <form method="POST">
            {% csrf_token %}

            <div class="mb-4">
                <label class="block text-gray-300 mb-1 font-medium">Semestre Total</label>
                {{ form.semestre|add_class:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded text-white" }}
            </div>

            <div class="mb-4">
                <label class="block text-gray-300 mb-1 font-medium">Maxima</label>
                {{ form.maxima|add_class:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded text-white" }}
            </div>

            <button type="submit" class="w-full bg-indigo-600 hover:bg-indigo-700 px-4 py-2 rounded-lg text-white font-semibold transition">
                Assigner
            </button>
        </form>
    </div>

    <div class="max-w-5xl mx-auto mt-12">
        <h2 class="text-2xl font-semibold text-indigo-300 mb-4">Maximas assign√©s aux Semestres de {{ classe.nom }}</h2>

        {% if semestres %}
            <div class="overflow-x-auto">
                <table class="min-w-full bg-gray-800 text-white rounded-lg">
                    <thead class="bg-gray-700">
                        <tr>
                            <th class="p-3 text-left">Semestre</th>
                            <th class="p-3 text-left">Maximas Assign√©s & Actions</th>
                        </tr>
                    </thead>

                    <tbody class="divide-y divide-gray-700">
                        {% for s in semestres %}
                        <tr class="hover:bg-gray-700 transition">
                            <td class="p-3 font-semibold">{{ s.nom }}</td>
                            <td class="p-3">

                                {% for m in s.maximas.all %}
                                <span class="inline-flex items-center bg-gray-700 px-3 py-1 rounded text-indigo-300 mr-2 mb-2">

                                    <!-- ‚≠ê MODAL TRIGGER -->
                                    <button 
                                        class="hover:text-white font-semibold mr-2"
                                        onclick="openMaximaModal(
                                            '{{ m.nom }}',
                                            '{{ m.note_attendue }}',
                                            '{{ m.periode }}',
                                            `{% for mat in m.matieres.all %}{{ mat.nom }}{% if not forloop.last %}, {% endif %}{% endfor %}`
                                        )"
                                    >
                                        {{ m.nom }} ({{ m.note_attendue }})
                                    </button>

                                    <!-- ‚ùå SUPPRESSION -->
                                    <button 
                                        onclick="confirmDeleteMaximaAssignment('{{ s.id }}','{{ m.id }}','{{ m.nom }}','{{ s.nom }}')"
                                        class="ml-2 text-red-400 hover:text-red-500 transition">
                                        ‚úñ
                                    </button>
                                </span>
                                {% endfor %}

                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>

                </table>
            </div>

        {% else %}
            <p class="text-center text-gray-400 mt-4">Aucun semestre trouv√© pour cette classe.</p>
        {% endif %}
    </div>

    <div class="mt-10 text-center">
        <a href="{% url 'classe_detail' classe.id %}" class="text-indigo-400 hover:underline">
            ‚Üê Retour √† la classe
        </a>
    </div>

</div>

<!-- üí† MODAL Maxima (version simple et fiable) -->
<div id="maximaModal" class="hidden fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50">
    <div class="bg-gray-900 rounded-xl p-6 relative max-w-md w-full">

        <button onclick="closeMaximaModal()"
                class="absolute top-2 right-2 bg-red-600 hover:bg-red-700 text-white font-bold w-8 h-8 flex items-center justify-center rounded-full shadow-lg">
            &times;
        </button>

        <h2 class="text-xl font-bold text-indigo-300 mb-4">D√©tails du Maxima</h2>

        <p id="modalMaximaNom" class="text-lg font-semibold text-white"></p>
        <p id="modalMaximaNote" class="text-yellow-400 font-bold"></p>
        <p id="modalMaximaPeriode" class="mt-3 text-gray-300"></p>

        <div id="modalMaximaMatieres" class="mt-4"></div>

    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<script>
/* ===========================
    MODAL OUVERTURE
=========================== */
function openMaximaModal(nom, note, periode, matieres) {
    document.getElementById('modalMaximaNom').innerText = "Maxima : " + nom;
    document.getElementById('modalMaximaNote').innerText = "Note attendue : " + note;
    document.getElementById('modalMaximaPeriode').innerHTML = "<strong>P√©riode :</strong> " + periode;

    let html = "<strong>Mati√®res :</strong><br>";
    matieres.split(",").forEach(m => {
        html += `<span class='bg-gray-700 px-2 py-1 rounded text-indigo-300 inline-block mr-1 mt-1'>${m.trim()}</span>`;
    });

    document.getElementById("modalMaximaMatieres").innerHTML = html;

    document.getElementById("maximaModal").classList.remove("hidden");
}

/* ===========================
    MODAL FERMETURE
=========================== */
function closeMaximaModal() {
    document.getElementById("maximaModal").classList.add("hidden");
}

/* ===========================
    SUPPRESSION MAXIMA
=========================== */
function confirmDeleteMaximaAssignment(semestreId, maximaId, maximaNom, semestreNom) {
    Swal.fire({
        title: "Supprimer ?",
        text: `Retirer '${maximaNom}' du semestre '${semestreNom}'`,
        icon: "warning",
        showCancelButton: true,
        confirmButtonColor: "#dc2626",
        cancelButtonColor: "#6b7280",
        confirmButtonText: "Oui, supprimer",
        cancelButtonText: "Annuler",
    }).then((result) => {
        if (result.isConfirmed) {
            const form = document.createElement("form");
            form.method = "POST";
            form.action = "";
            form.innerHTML = `
                {% csrf_token %}
                <input type="hidden" name="delete_maxima_assignment" value="1">
                <input type="hidden" name="semestre_id" value="${semestreId}">
                <input type="hidden" name="maxima_id" value="${maximaId}">
            `;
            document.body.appendChild(form);
            form.submit();
        }
    });
}
</script>
{% endblock %}



{% comment %} {% extends "base.html" %}
{% load static %}
{% load custom_filters %}

{% block title %}Assigner Maxima - {{ classe.nom }}{% endblock %}

{% block content %}
<div class="min-h-screen bg-gray-900 text-white py-10 px-4">

    <h1 class="text-3xl font-bold text-center text-indigo-400 mb-8">
        Assigner un Maxima au Semestre Total de la classe : {{ classe.nom }}
    </h1>

    <div class="max-w-xl mx-auto bg-gray-800 p-6 rounded-lg shadow-lg">
        <h2 class="text-xl text-green-400 mb-4 font-semibold">S√©lection</h2>

        <form method="POST">
            {% csrf_token %}

            <div class="mb-4">
                <label class="block text-gray-300 mb-1 font-medium">Semestre Total</label>
                {{ form.semestre|add_class:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded text-white" }}
            </div>

            <div class="mb-4">
                <label class="block text-gray-300 mb-1 font-medium">Maxima</label>
                {{ form.maxima|add_class:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded text-white" }}
            </div>

            <button type="submit" class="w-full bg-indigo-600 hover:bg-indigo-700 px-4 py-2 rounded-lg text-white font-semibold transition">
                Assigner
            </button>
        </form>
    </div>

    <div class="max-w-5xl mx-auto mt-12">
        <h2 class="text-2xl font-semibold text-indigo-300 mb-4">Maximas assign√©s aux Semestres de {{ classe.nom }}</h2>

        {% if semestres %}
            <div class="overflow-x-auto">
                <table class="min-w-full bg-gray-800 text-white rounded-lg">
                    <thead class="bg-gray-700">
                        <tr>
                            <th class="p-3 text-left">Semestre</th>
                            <th class="p-3 text-left">Maximas Assign√©s & Actions</th>
                        </tr>
                    </thead>

                    <tbody class="divide-y divide-gray-700">
                        {% for s in semestres %}
                        <tr class="hover:bg-gray-700 transition">
                            <td class="p-3 font-semibold">{{ s.nom }}</td>
                            <td class="p-3">

                                {% for m in s.maximas.all %}
                                <span class="inline-flex items-center bg-gray-700 px-3 py-1 rounded text-indigo-300 mr-2 mb-2">

                                    <!-- ‚≠ê MODAL TRIGGER ‚Äì sans fetch -->
                                    <button 
                                        class="hover:text-white font-semibold mr-2"
                                        onclick="openMaximaModal(
                                            '{{ m.nom }}',
                                            '{{ m.note_attendue }}',
                                            '{{ m.periode }}',
                                            `{% for mat in m.matieres.all %}{{ mat.nom }}{% if not forloop.last %}, {% endif %}{% endfor %}`
                                        )"
                                    >
                                        {{ m.nom }} ({{ m.note_attendue }})
                                    </button>

                                    <!-- ‚ùå SUPPRESSION -->
                                    <button 
                                        onclick="confirmDeleteMaximaAssignment('{{ s.id }}','{{ m.id }}','{{ m.nom }}','{{ s.nom }}')"
                                        class="ml-2 text-red-400 hover:text-red-500 transition">
                                        ‚úñ
                                    </button>
                                </span>
                                {% endfor %}

                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>

                </table>
            </div>

        {% else %}
            <p class="text-center text-gray-400 mt-4">Aucun semestre trouv√© pour cette classe.</p>
        {% endif %}
    </div>

    <div class="mt-10 text-center">
        <a href="{% url 'classe_detail' classe.id %}" class="text-indigo-400 hover:underline">
            ‚Üê Retour √† la classe
        </a>
    </div>

</div>

<!-- üí† MODAL Maxima (version simple et fiable) -->
<div id="maximaModal" class="hidden fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50">
    <div class="bg-gray-900 rounded-xl p-6 relative max-w-md w-full">

        <button onclick="closeMaximaModal()"
                class="absolute top-2 right-2 bg-red-600 hover:bg-red-700 text-white font-bold w-8 h-8 flex items-center justify-center rounded-full shadow-lg">
            &times;
        </button>

        <h2 class="text-xl font-bold text-indigo-300 mb-4">D√©tails du Maxima</h2>

        <p id="modalMaximaNom" class="text-lg font-semibold text-white"></p>
        <p id="modalMaximaNote" class="text-yellow-400 font-bold"></p>
        <p id="modalMaximaPeriode" class="mt-3 text-gray-300"></p>

        <div id="modalMaximaMatieres" class="mt-4"></div>

    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<script>
/* ===========================
    MODAL OUVERTURE
=========================== */
function openMaximaModal(nom, note, periode, matieres) {
    document.getElementById('modalMaximaNom').innerText = "Maxima : " + nom;
    document.getElementById('modalMaximaNote').innerText = "Note attendue : " + note;
    document.getElementById('modalMaximaPeriode').innerHTML = "<strong>P√©riode :</strong> " + periode;

    let html = "<strong>Mati√®res :</strong><br>";
    matieres.split(",").forEach(m => {
        html += `<span class='bg-gray-700 px-2 py-1 rounded text-indigo-300 inline-block mr-1 mt-1'>${m.trim()}</span>`;
    });

    document.getElementById("modalMaximaMatieres").innerHTML = html;

    document.getElementById("maximaModal").classList.remove("hidden");
}

/* ===========================
    MODAL FERMETURE
=========================== */
function closeMaximaModal() {
    document.getElementById("maximaModal").classList.add("hidden");
}

/* ===========================
    SUPPRESSION MAXIMA
=========================== */
function confirmDeleteMaximaAssignment(semestreId, maximaId, maximaNom, semestreNom) {
    Swal.fire({
        title: "Supprimer ?",
        text: `Retirer '${maximaNom}' du semestre '${semestreNom}'`,
        icon: "warning",
        showCancelButton: true,
        confirmButtonColor: "#dc2626",
        cancelButtonColor: "#6b7280",
        confirmButtonText: "Oui, supprimer",
        cancelButtonText: "Annuler",
    }).then((result) => {
        if (result.isConfirmed) {
            const form = document.createElement("form");
            form.method = "POST";
            form.action = "";
            form.innerHTML = `
                {% csrf_token %}
                <input type="hidden" name="delete_maxima_assignment" value="1">
                <input type="hidden" name="semestre_id" value="${semestreId}">
                <input type="hidden" name="maxima_id" value="${maximaId}">
            `;
            document.body.appendChild(form);
            form.submit();
        }
    });
}
</script>
{% endblock %} {% endcomment %}


{% comment %} {% extends "base.html" %}
{% load static %}
{% load custom_filters %}

{% block title %}Assigner Maxima - {{ classe.nom }}{% endblock %}

{% block content %}
<div class="min-h-screen bg-gray-900 text-white py-10 px-4">

    <h1 class="text-3xl font-bold text-center text-indigo-400 mb-8">
        Assigner un Maxima au Semestre Total de la classe : {{ classe.nom }}
    </h1>

    <div class="max-w-xl mx-auto bg-gray-800 p-6 rounded-lg shadow-lg">
        <h2 class="text-xl text-green-400 mb-4 font-semibold">S√©lection</h2>

        <form method="POST">
            {% csrf_token %}

            <div class="mb-4">
                <label class="block text-gray-300 mb-1 font-medium">Semestre Total</label>
                {{ form.semestre|add_class:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded text-white" }}
            </div>

            <div class="mb-4">
                <label class="block text-gray-300 mb-1 font-medium">Maxima</label>
                {{ form.maxima|add_class:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded text-white" }}
            </div>

            <button type="submit" class="w-full bg-indigo-600 hover:bg-indigo-700 px-4 py-2 rounded-lg text-white font-semibold transition">
                Assigner
            </button>
        </form>
    </div>

    <div class="max-w-5xl mx-auto mt-12">
        <h2 class="text-2xl font-semibold text-indigo-300 mb-4">Maximas assign√©s aux Semestres de {{ classe.nom }}</h2>

        {% if semestres %}
            <div class="overflow-x-auto">
                <table class="min-w-full bg-gray-800 text-white rounded-lg">
                    <thead class="bg-gray-700">
                        <tr>
                            <th class="p-3 text-left">Semestre</th>
                            <th class="p-3 text-left">Maximas Assign√©s & Actions</th>
                        </tr>
                    </thead>

                    <tbody class="divide-y divide-gray-700">
                        {% for s in semestres %}
                        <tr class="hover:bg-gray-700 transition">
                            <td class="p-3 font-semibold">{{ s.nom }}</td>
                            <td class="p-3">

                                {% for m in s.maximas.all %}
                                <span class="inline-flex items-center bg-gray-700 px-3 py-1 rounded text-indigo-300 mr-2 mb-2">

                                    <!-- ‚≠ê CLIQUE POUR OUVRIR LE MODAL -->
                                    <button onclick="openMaximaModal({{ m.id }})" 
                                            class="hover:text-white font-semibold mr-2">
                                        {{ m.nom }} ({{ m.note_attendue }})
                                    </button>

                                    <!-- ‚ùå SUPPRESSION -->
                                    <button 
                                        onclick="confirmDeleteMaximaAssignment('{{ s.id }}','{{ m.id }}','{{ m.nom }}','{{ s.nom }}')"
                                        class="ml-2 text-red-400 hover:text-red-500 transition">
                                        ‚úñ
                                    </button>
                                </span>
                                {% endfor %}

                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>

                </table>
            </div>

        {% else %}
            <p class="text-center text-gray-400 mt-4">Aucun semestre trouv√© pour cette classe.</p>
        {% endif %}
    </div>

    <div class="mt-10 text-center">
        <a href="{% url 'classe_detail' classe.id %}" class="text-indigo-400 hover:underline">
            ‚Üê Retour √† la classe
        </a>
    </div>

</div>

<!-- üí† MODAL Maxima D√©tails -->
<div id="maximaModal" class="hidden fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center">
    <div class="bg-gray-800 p-6 rounded-lg shadow-xl w-96">

        <h2 class="text-xl font-bold text-indigo-300 mb-4">D√©tails du Maxima</h2>

        <p id="periode" class="my-2"></p>
        <p id="note" class="my-2 font-bold text-yellow-400"></p>
        <div id="matieres" class="mt-3"></div>

        <button onclick="closeMaximaModal()" 
                class="mt-6 w-full bg-red-600 hover:bg-red-700 text-white py-2 rounded">
            Fermer
        </button>
    </div>
</div>


<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<script>
/* ================================
      üü£ 1. OUVERTURE DU MODAL
================================ */
function openMaximaModal(maximaId) {
    fetch(`/api/maxima/${maximaId}/`)  // √Ä cr√©er si pas encore existant
        .then(response => response.json())
        .then(data => {
            document.getElementById("periode").innerHTML =
                "<strong>P√©riode :</strong> " + data.periode;

            document.getElementById("note").innerHTML =
                "Note attendue : " + data.note_attendue;

            let matHTML = "<strong>Mati√®res :</strong><br>";
            data.matieres.forEach(mat => {
                matHTML += `<span class='bg-gray-700 px-2 py-1 rounded text-indigo-300 inline-block mr-1 mt-1'>${mat}</span>`;
            });

            document.getElementById("matieres").innerHTML = matHTML;

            document.getElementById("maximaModal").classList.remove("hidden");
        });
}

function closeMaximaModal() {
    document.getElementById("maximaModal").classList.add("hidden");
}

/* ==========================================
      üü• 2. SUPPRESSION AVEC CONFIRMATION
========================================== */
function confirmDeleteMaximaAssignment(semestreId, maximaId, maximaNom, semestreNom) {
    Swal.fire({
        title: "Supprimer l'assignation ?",
        text: `Retirer '${maximaNom}' du Semestre '${semestreNom}'`,
        icon: "warning",
        showCancelButton: true,
        confirmButtonColor: "#dc2626",
        cancelButtonColor: "#6b7280",
        confirmButtonText: "Oui, supprimer",
        cancelButtonText: "Annuler",
    }).then((result) => {
        if (result.isConfirmed) {
            const form = document.createElement("form");
            form.method = "POST";
            form.action = "";
            form.innerHTML = `
                {% csrf_token %}
                <input type="hidden" name="delete_maxima_assignment" value="1">
                <input type="hidden" name="semestre_id" value="${semestreId}">
                <input type="hidden" name="maxima_id" value="${maximaId}">
            `;
            document.body.appendChild(form);
            form.submit();
        }
    });
}
</script>
{% endblock %} {% endcomment %}

{% comment %} {% block extra_js %}


{% endblock %} {% endcomment %}


{% comment %} {% extends "base.html" %}
{% load static %}
{% load custom_filters %}

{% block title %}Assigner Maxima - {{ classe.nom }}{% endblock %}

{% block content %}
<div class="min-h-screen bg-gray-900 text-white py-10 px-4">

    <h1 class="text-3xl font-bold text-center text-indigo-400 mb-8">
        Assigner un Maxima au Semestre Total de la classe : {{ classe.nom }}
    </h1>

    <div class="max-w-xl mx-auto bg-gray-800 p-6 rounded-lg shadow-lg">
        <h2 class="text-xl text-green-400 mb-4 font-semibold">S√©lection</h2>

        <form method="POST">
            {% csrf_token %}

            <div class="mb-4">
                <label class="block text-gray-300 mb-1 font-medium">Semestre Total</label>
                {{ form.semestre|add_class:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded text-white" }}
            </div>

            <div class="mb-4">
                <label class="block text-gray-300 mb-1 font-medium">Maxima</label>
                {{ form.maxima|add_class:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded text-white" }}
            </div>

            <button type="submit" class="w-full bg-indigo-600 hover:bg-indigo-700 px-4 py-2 rounded-lg text-white font-semibold transition">
                Assigner
            </button>
        </form>
    </div>

    <div class="max-w-5xl mx-auto mt-12">
        <h2 class="text-2xl font-semibold text-indigo-300 mb-4">Maximas assign√©s aux Semestres de {{ classe.nom }}</h2>

        {% if semestres %}
            <div class="overflow-x-auto">
                <table class="min-w-full bg-gray-800 text-white rounded-lg">
                    <thead class="bg-gray-700">
                        <tr>
                            <th class="p-3 text-left">Semestre</th>
                            <th class="p-3 text-left">Maximas Assign√©s & Actions</th>
                        </tr>
                    </thead>
                    <tbody class="divide-y divide-gray-700">
                        {% for s in semestres %}
                        <tr class="hover:bg-gray-700 transition">
                            <td class="p-3 font-semibold">{{ s.nom }}</td>
                            <td class="p-3">
                                {% if s.maximas.all %}
                                    {% for m in s.maximas.all %}
                                        <span class="inline-flex items-center bg-gray-700 px-3 py-1 rounded text-indigo-300 mr-2 mb-2">
                                            {{ m.nom }} ({{ m.note_attendue }})
                                            
                                            {# BOUTON DE SUPPRESSION #}
                                            <button 
                                                type="button" 
                                                onclick="confirmDeleteMaximaAssignment('{{ s.id }}', '{{ s.nom }}', '{{ m.id }}', '{{ m.nom }}')" 
                                                class="ml-2 text-red-400 hover:text-red-500 transition focus:outline-none"
                                                title="Retirer cette assignation">
                                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                                                </svg>
                                            </button>
                                        </span>
                                    {% endfor %}
                                {% else %}
                                    <span class="text-gray-400">Aucun maxima assign√©</span>
                                {% endif %}
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        {% else %}
            <p class="text-center text-gray-400 mt-4">Aucun semestre trouv√© pour cette classe.</p>
        {% endif %}
    </div>

    <div class="mt-10 text-center">
        <a href="{% url 'classe_detail' classe.id %}" class="text-indigo-400 hover:underline">
            ‚Üê Retour √† la classe
        </a>
    </div>

</div>

{% endblock %}

{% block extra_js %}
{# Assurez-vous d'avoir inclus la biblioth√®que SweetAlert dans votre base.html #}

<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
    function confirmDeleteMaximaAssignment(semestreId, semestreNom, maximaId, maximaNom) {
        // ... (Votre fonction est inchang√©e et est correcte)
        Swal.fire({
            title: '√ätes-vous s√ªr ?',
            text: `Le Maxima "${maximaNom}" sera retir√© du Semestre "${semestreNom}". Confirmez-vous ?`,
            icon: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#dc2626',
            cancelButtonColor: '#6b7280',
            confirmButtonText: 'Oui, retirer',
            cancelButtonText: 'Annuler'
        }).then((result) => {
            if (result.isConfirmed) {
                const form = document.createElement('form');
                form.method = 'POST';
                form.action = '';
                form.innerHTML = `
                    {% csrf_token %}
                    <input type="hidden" name="semestre_id" value="${semestreId}">
                    <input type="hidden" name="maxima_id" value="${maximaId}">
                    <input type="hidden" name="delete_maxima_assignment" value="1">
                `;
                document.body.appendChild(form);
                form.submit();
            }
        });
    }
    </script>
{% endblock %} {% endcomment %}


{% comment %} {% extends "base.html" %}
{% load static %}
{% load custom_filters %}
{% block title %}Assigner Maxima - {{ classe.nom }}{% endblock %}

{% block content %}
<div class="min-h-screen bg-gray-900 text-white py-10 px-4">

    <!-- Titre principal -->
    <h1 class="text-3xl font-bold text-center text-indigo-400 mb-8">
        Assigner un Maxima au Semestre Total de la classe : {{ classe.nom }}
    </h1>

    <!-- Bloc formulaire -->
    <div class="max-w-xl mx-auto bg-gray-800 p-6 rounded-lg shadow-lg">
        <h2 class="text-xl text-green-400 mb-4 font-semibold">S√©lection</h2>

        <form method="POST">
            {% csrf_token %}

            <!-- Champ Semestre -->
            <div class="mb-4">
                <label class="block text-gray-300 mb-1 font-medium">Semestre Total</label>
                {{ form.semestre|add_class:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded text-white" }}
            </div>

            <!-- Champ Maxima -->
            <div class="mb-4">
                <label class="block text-gray-300 mb-1 font-medium">Maxima</label>
                {{ form.maxima|add_class:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded text-white" }}
            </div>

            <button class="w-full bg-indigo-600 hover:bg-indigo-700 px-4 py-2 rounded-lg text-white font-semibold transition">
                Assigner
            </button>
        </form>
    </div>

    <!-- Liste des semestres et maximas assign√©s -->
    <div class="max-w-5xl mx-auto mt-12">
        <h2 class="text-2xl font-semibold text-indigo-300 mb-4">Semestres de {{ classe.nom }}</h2>

        {% if semestres %}
            <div class="overflow-x-auto">
                <table class="min-w-full bg-gray-800 text-white rounded-lg">
                    <thead class="bg-gray-700">
                        <tr>
                            <th class="p-3 text-left">Semestre</th>
                            <th class="p-3 text-left">Maximas Assign√©s</th>
                        </tr>
                    </thead>
                    <tbody class="divide-y divide-gray-700">
                        {% for s in semestres %}
                        <tr class="hover:bg-gray-700 transition">
                            <td class="p-3 font-semibold">{{ s.nom }}</td>
                            <td class="p-3">
                                {% if s.maximas.all %}
                                    {% for m in s.maximas.all %}
                                        <span class="bg-gray-700 px-3 py-1 rounded text-indigo-300 mr-2">
                                            {{ m.nom }} ({{ m.note_attendue }})
                                        </span>
                                    {% endfor %}
                                {% else %}
                                    <span class="text-gray-400">Aucun maxima assign√©</span>
                                {% endif %}
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        {% else %}
            <p class="text-center text-gray-400 mt-4">Aucun semestre trouv√© pour cette classe.</p>
        {% endif %}
    </div>

    <!-- Retour -->
    <div class="mt-10 text-center">
        <a href="{% url 'classe_detail' classe.id %}" class="text-indigo-400 hover:underline">
            ‚Üê Retour √† la classe
        </a>
    </div>

</div>
{% endblock %} {% endcomment %}
