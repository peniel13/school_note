{% load custom_tags %}
{% load static %}
<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Bulletin de {{ eleve.nom }}</title>

{% if semestres|length == 3 %}
    {# --- CSS SPÉCIFIQUE AU FORMAT PAYSAGE (3 SEMESTRES) --- #}
    <style>
        /* Déclaration pour forcer le format Paysage dans les moteurs PDF */
        @page {
            size: A4 landscape;
            margin: 5mm; 
        }

        body { 
            font-family: "Times New Roman", serif; 
            color:#000; 
            margin:0; 
            padding:0; 
        }
        .bulletin { 
            width: 100%; 
            margin: 0 auto; 
            background-color: white; 
            padding: 5mm 5mm; 
            border: 1px solid #000;
            box-sizing: border-box;
            font-size: 8.5pt; 
        }

        /* Réduction des tailles de police pour gagner de l'espace */
        .header-text h1 { font-size: 10pt; }
        .header-text h2 { font-size: 9pt; }
        .header-text h3, .header-text h4 { font-size: 8pt; }
        .info-block { font-size: 7.5pt; }
        .title-line { font-size: 8.5pt; }

        /* Tableau en Paysage */
        table { 
            font-size: 6.5pt; /* Maximize space for 16 columns */
            table-layout: fixed; 
        }
        th, td { 
            padding: 0.3mm 0.2mm; 
        }
        .branch-cell { text-align:left; padding-left: 1mm; } 
        .footer-section { font-size: 7pt; }
    </style>
{% else %}
    {# --- CSS SPÉCIFIQUE AU FORMAT PORTRAIT (2 SEMESTRES) --- #}
    <style>
        /* Déclaration pour forcer le format Portrait (optionnel, c'est le défaut) */
        @page {
            size: A4 portrait;
            margin: 8mm; /* Marge standard légèrement plus grande que Paysage */
        }
        
        body { 
            font-family: "Times New Roman", serif; 
            color:#000; 
            margin:0; 
            padding:0; 
        }
        .bulletin { 
            width: 100%; 
            margin: 0 auto; 
            background-color: white; 
            padding: 5mm 5mm; 
            border: 1px solid #000;
            box-sizing: border-box;
            font-size: 8.5pt; 
        }
        /* ... (Collez ici le reste de votre CSS Portrait non spécifique au Paysage) ... */
        .header-text h1 { font-size: 10.5pt; }
        .header-text h2 { font-size: 9.5pt; } 
        .header-text h3, .header-text h4 { font-size: 8.5pt; } 
        .info-block { font-size: 8pt; } 

        /* Tableau en Portrait */
        table { 
            font-size: 6.8pt; 
            table-layout: fixed; 
        }
        th, td { 
            padding: 0.5mm 0.3mm; 
        }
        .branch-cell { text-align:left; padding-left: 2mm; } 
        .footer-section { font-size: 7pt; }

    </style>
{% endif %}

{# --- CSS COMMUN À TOUS LES FORMATS (à conserver si non redéfini ci-dessus) --- #}
<style>
    /* Style général du tableau commun */
    table { border-collapse: collapse; width: 100%; margin-bottom: 3px; }
    th, td { border: 1px solid #000; word-wrap: break-word; height: auto; }
    th { background:#eee; font-weight: bold; }
    .header-title { background: #ccc; text-align: center } 
    .header-sem { background: #ddd; text-align: center}
    .section-title { font-weight: bold; background:#f0f0f0; text-align: left; }
    .note-rouge { color:red; font-weight:bold; }
    .total-row td { font-weight: bold; background: #eee; }
    
    /* Styles flexbox pour l'en-tête et le pied de page */
    .header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 3px; }
    .logo-left, .logo-right { width: 15%; text-align: center; }
    .logo-left img, .logo-right img { max-height: 15mm; max-width: 100%; display: block; margin: 0 auto; }
    .header-text { flex: 1; text-align: center; line-height: 1.0; width: 70%; }
    .info-block { border-top: 1px solid black; padding-top: 3px; margin: 3px 0; }
    .info-row { display: flex; margin-bottom: 1px; }
    .info-item { display: flex; align-items: flex-end; margin-right: 10px; flex-grow: 1; }
    .info-item p { margin: 0 5px 0 0; white-space: nowrap; }
    .line { border-bottom: 1px dashed black; flex-grow: 1; height: 8pt; }
    .full-line { flex-grow: 1; }
    .title-line { text-align: center; font-weight: bold; margin: 3px 0; text-transform: uppercase; }
    .footer-section { display: flex; justify-content: space-between; margin-top: 3px; }
    .footer-left { width: 55%; line-height: 1.1; }
    .footer-right { width: 40%; text-align: right; }
    .decision-box { border: 1px solid black; padding: 2px; margin-bottom: 3px; text-align: left; }
    .decision-title { font-weight: bold; text-decoration: underline; text-align: center; margin: 0; }
    .signature-line { display: flex; justify-content: space-between; margin-top: 3px; }
    .signature-line p { margin: 0; }
    .chefetab-sig { margin-top: 10px; }
</style>
</head>
<body>
<div class="bulletin">

    {# --- EN-TÊTE FIXE (COMMUN) --- #}
    <div class="header">
        <div class="logo-left">
            <img src="{{ drapeau }}" alt="Drapeau RDC">
        </div>
        <div class="header-text">
            <h1>RÉPUBLIQUE DÉMOCRATIQUE DU CONGO</h1>
            <h2>MINISTÈRE DE L’ENSEIGNEMENT PRIMAIRE, SECONDAIRE ET PROFESSIONNEL</h2>
            <h3>ÉCOLE : {{ school.nom }}</h3>
            <h4>Année scolaire : {{ school.annee_scolaire }}</h4>
        </div>
        <div class="logo-right">
            <img src="{{ sceau }}" alt="Sceau">
        </div>
    </div>
    
    <div class="info-block">
        <div class="info-row">
            <div class="info-item" style="width: 30%;">
                <p>N° ID.</p>
                <div class="line"></div>
            </div>
            <div class="info-item full-line">
                <p>PROVINCE</p>
                <div class="line">{{ school.province.nom|default:"..." }}</div>
            </div>
        </div>
        <div class="info-row">
            <div class="info-item" style="width: 25%;">
                <p>VILLE</p>
                <div class="line">{{ eleve.city.nom|default:"..." }}</div>
            </div>
            <div class="info-item" style="width: 50%;">
                <p>ÉLÈVE</p>
                <div class="line">{{ eleve.nom|upper }}</div>
            </div>
            <div class="info-item" style="width: 15%;">
                <p>SEXE</p>
                <div class="line">{{ eleve.sexe|default:"-" }}</div>
            </div>
        </div>
        <div class="info-row">
            <div class="info-item" style="width: 25%;">
                <p>COMMUNE/TER</p>
                <div class="line">{{ eleve.commune.nom|default:"..." }}</div>
            </div>
            <div class="info-item" style="width: 35%;">
                <p>NÉ(E) À</p>
                <div class="line">{{ eleve.lieu_naissance|default:"..." }}</div>
            </div>
            <div class="info-item" style="width: 30%;">
                <p>LE</p>
                <div class="line">{{ eleve.date_naissance|date:"d/m/Y"|default:"..." }}</div>
            </div>
        </div>
        <div class="info-row">
            <div class="info-item" style="width: 25%;">
                <p>ÉCOLE</p>
                <div class="line">{{ school.nom }}</div>
            </div>
            <div class="info-item" style="width: 35%;">
                <p>CLASSE</p>
                <div class="line">{{ classe.nom }}</div>
            </div>
            <div class="info-item" style="width: 30%;">
                <p>N° PERM.</p>
                <div class="line">[ _ _ _ _ _ _ ]</div>
            </div>
        </div>
        <div class="info-row" style="justify-content: flex-end; margin-top: 3px;">
            <div class="info-item" style="width: 25%;">
                <p>CODE</p>
                <div class="line">[ _ _ _ _ _ _ ]</div>
            </div>
        </div>
    </div>
    
    <div class="title-line">
        Bulletin de la classe de {{ classe.nom }} — Année scolaire {{ school.annee_scolaire }}
    </div>

    {# --- DÉBUT DU TABLEAU CONDITIONNEL --- #}
    <table>
        <thead>
            <tr>
                <th rowspan="4">BRANCHES</th>
                
                {# Définition de la colonne principale : 8 colonnes pour 2 Semestres, 12 colonnes pour 3 Semestres #}
                {% if semestres|length == 2 %}
                    <th colspan="8" class="header-title">BULLETIN DE {{ classe.nom }} — Année scolaire {{ school.annee_scolaire }}</th>
                {% elif semestres|length == 3 %}
                    <th colspan="12" class="header-title">BULLETIN DE {{ classe.nom }} — Année scolaire {{ school.annee_scolaire }}</th>
                {% else %}
                    {# Si le nombre est différent, on tente de calculer la colspan dynamiquement (4 * N semestres) #}
                    {% with col_span=semestres|length|times:4 %}
                        <th colspan="{{ col_span }}" class="header-title">BULLETIN DE {{ classe.nom }} — Année scolaire {{ school.annee_scolaire }}</th>
                    {% endwith %}
                {% endif %}

                {# Colonnes finales fixes #}
                <th rowspan="4">TOT GÉN</th>
                <th rowspan="4" class="header-repa">% EXAMEN DE REPÊCHAGE</th>
                <th rowspan="4" class="header-sign">Sign. Prof</th>
            </tr>
            <tr>
                {# En-tête de la deuxième ligne : Semestres #}
                {% for semestre in semestres %}
                    <th colspan="4" class="header-title">{{ semestre.nom|upper }}</th>
                {% endfor %}
            </tr>
            <tr>
                {# En-tête de la troisième ligne : Journalier / Total Semestre #}
                {% for semestre in semestres %}
                    <th colspan="3" class="header-sem">JOURNAL.</th>
                    <th rowspan="2" class="header-tot">TOT. SEM.</th>
                {% endfor %}
            </tr>
            <tr>
                {# En-tête de la quatrième ligne : Noms des Périodes (3 premières seulement) #}
                {% for semestre in semestres %}
                    {% for p in periodes_par_semestre|get_item:semestre %}
                        {% if forloop.counter <= 3 %}
                            <th>{{ p.nom }}</th>
                        {% endif %}
                    {% endfor %}
                {% endfor %}
            </tr>
        </thead>

        <tbody>
            {# Le corps du tableau est le même, la boucle sur 'semestres' gère le nombre de colonnes #}
            {% for section in bulletin_sections %}
            
                <tr class="section-title">
                <td>MAXIMA ({{ section.maxima_identifiant|default:'ND' }})</td>
                
                {% for semestre in semestres %}
                    {% for p in periodes_par_semestre|get_item:semestre %}
                        {% if forloop.counter <= 3 %}
                            <td>{{ section.maxima_notes_by_periode|get_item:p|default:"-"|floatformat:2 }}</td>
                        {% endif %}
                    {% endfor %}
                    <td>{{ section.maxima_section_totaux|get_item:semestre|floatformat:2 }}</td>
                {% endfor %}
                
                <td>{{ section.total_general_maxima_section|floatformat:2 }}</td>
                <td>—</td>
                <td>—</td>
                </tr>
            
                {% for matiere in section.matieres_section %}
                    <tr>
                        <td class="branch-cell">{{ matiere.nom }}</td>
                        
                        {% for semestre in semestres %}
                            {% for p in periodes_par_semestre|get_item:semestre %}
                                {% if forloop.counter <= 3 %}
                                    {% with note=notes_by_matiere|get_item:matiere|get_item:p %}
                                        {% with maxima_val_period=section.maxima_notes_by_periode|get_item:p %} 
                                            {% if note and note.note_obtenue is not None %}
                                                {% if maxima_val_period and note.note_obtenue < maxima_val_period|floatdivide:2 %}
                                                    <td class="note-rouge">{{ note.note_obtenue|floatformat:2 }}</td>
                                                {% else %}
                                                    <td>{{ note.note_obtenue|floatformat:2|default:"-" }}</td>
                                                {% endif %}
                                            {% else %}
                                                <td>-</td>
                                            {% endif %}
                                        {% endwith %}
                                    {% endwith %}
                                {% endif %}
                            {% endfor %}
                            
                            {% with total_mat_sem=section.totaux_semestre_par_matiere|get_item:matiere|get_item:semestre %}
                                {% with max_sem=section.maxima_section_totaux|get_item:semestre %}
                                    {% if max_sem > 0 and total_mat_sem < max_sem|floatdivide:2 %}
                                        <td class="note-rouge">{{ total_mat_sem|floatformat:2 }}</td>
                                    {% else %}
                                        <td>{{ total_mat_sem|floatformat:2 }}</td>
                                    {% endif %}
                                {% endwith %}
                            {% endwith %}
                        {% endfor %}
                        
                        {% with total_global=section.totaux_global_par_matiere|get_item:matiere %}
                            {% with max_tg=section.total_general_maxima_section %}
                                {% if max_tg > 0 and total_global < max_tg|floatdivide:2 %}
                                    <td class="note-rouge">{{ total_global|floatformat:2 }}</td>
                                {% else %}
                                    <td>{{ total_global|floatformat:2 }}</td>
                                {% endif %}
                            {% endwith %}
                        {% endwith %}
                        
                        <td>—</td>
                        <td>—</td>
                    </tr>
                {% endfor %}
            {% endfor %}
        </tbody>

        <tfoot>
            {# Lignes TOTAUX, POURCENTAGE, PLACE (identiques, la boucle gère les colonnes) #}
            
            <tr class="total-row">
                <td>MAXIMA GÉNÉRAUX</td>
                {% for semestre in semestres %}
                    {% for p in periodes_par_semestre|get_item:semestre %}
                        {% if forloop.counter <= 3 %}
                            <td>{{ maxima_generaux|get_item:p|floatformat:2 }}</td>
                        {% endif %}
                    {% endfor %}
                    <td>{{ totaux_semestre|get_item:semestre|floatformat:2 }}</td>
                {% endfor %}
                <td>{{ total_general_attendu|floatformat:2 }}</td>
                <td>—</td>
                <td>—</td>
            </tr>
            
            <tr class="total-row">
                <td>TOTAUX</td>
                {% for semestre in semestres %}
                    {% for p in periodes_par_semestre|get_item:semestre %}
                        {% if forloop.counter <= 3 %}
                            {% if total_periode_obtenu|get_item:p < maxima_generaux|get_item:p|floatdivide:2 %}
                                <td class="note-rouge">{{ total_periode_obtenu|get_item:p|floatformat:2 }}</td>
                            {% else %}
                                <td>{{ total_periode_obtenu|get_item:p|floatformat:2 }}</td>
                            {% endif %}
                        {% endif %}
                    {% endfor %}
                    {% if total_semestre_obtenu|get_item:semestre < totaux_semestre|get_item:semestre|floatdivide:2 %}
                        <td class="note-rouge">{{ total_semestre_obtenu|get_item:semestre|floatformat:2 }}</td>
                    {% else %}
                        <td>{{ total_semestre_obtenu|get_item:semestre|floatformat:2 }}</td>
                    {% endif %}
                {% endfor %}
                {% if total_obtenu < total_general_attendu|floatdivide:2 %}
                    <td class="note-rouge">{{ total_obtenu|floatformat:2 }}</td>
                {% else %}
                    <td>{{ total_obtenu|floatformat:2 }}</td>
                {% endif %}
                <td>—</td>
                <td>—</td>
            </tr>
        
            <tr class="total-row">
                <td>POURCENTAGE</td>
                {% for semestre in semestres %}
                    {% for p in periodes_par_semestre|get_item:semestre %}
                        {% if forloop.counter <= 3 %}
                            {% if pourcentage_periode|get_item:p < 50 %}
                                <td class="note-rouge">{{ pourcentage_periode|get_item:p|floatformat:2 }} %</td>
                            {% else %}
                                <td>{{ pourcentage_periode|get_item:p|floatformat:2 }} %</td>
                            {% endif %}
                        {% endif %}
                    {% endfor %}
                    {% if pourcentage_semestre|get_item:semestre < 50 %}
                        <td class="note-rouge">{{ pourcentage_semestre|get_item:semestre|floatformat:2 }} %</td>
                    {% else %}
                        <td>{{ pourcentage_semestre|get_item:semestre|floatformat:2 }} %</td>
                    {% endif %}
                {% endfor %}
                {% if pourcentage_total < 50 %}
                    <td class="note-rouge">{{ pourcentage_total|floatformat:2 }} %</td>
                {% else %}
                    <td>{{ pourcentage_total|floatformat:2 }} %</td>
                {% endif %}
                <td>—</td>
                <td>—</td>
            </tr>
        
            <tr class="total-row">
                <td>PLACE / NBRE ÉLÈVES</td>
                {% for semestre in semestres %}
                    {% for p in periodes_par_semestre|get_item:semestre %}
                        {% if forloop.counter <= 3 %}
                            <td>{{ rang_par_periode|get_item:p|default:"—" }}</td>
                        {% endif %}
                    {% endfor %}
                    <td>{{ rang_par_semestre|get_item:semestre|default:"—" }}</td>
                {% endfor %}
                <td>{{ rang_general|default:"—" }}</td>
                <td>—</td>
                <td>—</td>
            </tr>
            
            {# --- LIGNES VIDES CORRIGÉES (UTILISATION DU CALCUL DYNAMIQUE) --- #}
            {% with total_data_columns=semestres|length|times:4|add:3 %}
                <tr class="total-row">
                    <td>APPLICATION / CONDUITE</td>
                    {# (3 P + 1 TS) * N Sem + 1 TG + 1 Rep + 1 Sign #}
                    {% for i in ""|ljust:total_data_columns %}<td></td>{% endfor %}
                </tr>
                <tr class="total-row">
                    <td>SIGN. RESPONSABLE</td>
                    {% for i in ""|ljust:total_data_columns %}<td></td>{% endfor %}
                </tr>
            {% endwith %}
        </tfoot>
    </table>
    
    {# --- PIED DE PAGE FIXE (COMMUN) --- #}
    <div class="footer-section">
        <div class="footer-left">
            <p>--- L'élève ne pourra pas accéder à la classe supérieure s'il n'a pas réussi avec succès un examen de repêchage en</p>
            <p style="border-bottom: 1px solid black; margin-top: 5px;">&nbsp;</p>
            <p style="margin-top: 5px;">( ) s'il(elle) passe dans la classe supérieure</p>
            <p>( ) s'il(elle) redouble la classe</p>
            <p>( ) s'il(elle) est exclu par le Conseil des Professeurs</p>
            
            <div class="signature-line" style="margin-top: 15px;">
                <p>Signature des parents</p>
                <p>Signature de l'élève</p>
            </div>
            
            <p style="margin-top: 5px;">*Note importante* : Le bulletin est sans valeur s'il est raturé ou surchargé</p>
        </div>
        
        <div class="footer-right">
            <div class="decision-box">
                <p class="decision-title">Décision</p>
                <p>- Passe - Double ( )</p>
                <p>- A échoué ( )</p>
            </div>
            <div class="signature-line right-aligned" style="justify-content: flex-end;">
                <p>Fait à .................................................., le ...... / ...... / 20.....</p>
            </div>
            <div class="chefetab-sig">
                <p>Le Chef d'établissement,</p>
                <p style="margin-top: 20px;">_________________________</p>
            </div>
        </div>
    </div>
    
</div>
</body>
</html>

{% comment %} {% load custom_tags %}
{% load static %}
<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Bulletin de {{ eleve.nom }}</title>
<style>
  /* Style général optimisé pour l'impression A4 */
  body { 
      font-family: "Times New Roman", serif; 
      background:#f0f0f0; 
      color:#000; 
      margin:0; 
      padding:0; /* Enlève le padding du body */
  }
  .bulletin { 
      /* Retire la taille A4 fixe (width: 210mm; min-height: 297mm;) */
      width: 100%; /* S'adapte à la largeur disponible dans les marges @page */
      margin: 0 auto; 
      background-color: white; 
      padding: 5mm 5mm; /* Réduit le padding interne du bulletin (au lieu de 8mm 10mm) */
      border: 1px solid #000;
      box-sizing: border-box;
      font-size: 8.5pt; /* Taille de police de base légèrement réduite (au lieu de 9pt) */
  }
  
  /* En-tête : Réduction des tailles de police pour gagner de l'espace vertical */
  .header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 3px; }
  .logo-left, .logo-right { width: 15%; text-align: center; }
  .logo-left img, .logo-right img { max-height: 15mm; max-width: 100%; display: block; margin: 0 auto; } /* Réduit max-height */
  .header-text { flex: 1; text-align: center; line-height: 1.0; width: 70%; } /* Réduit line-height */
  .header-text h1 { font-size: 10.5pt; } /* Réduit de 11pt */
  .header-text h2 { font-size: 9.5pt; } /* Réduit de 10pt */
  .header-text h3, .header-text h4 { font-size: 8.5pt; } /* Réduit de 9pt */
  /* Bloc d'informations de l'élève (Hauteur Diminuée) */
.info-block { 
    border-top: 1px solid black; 
    padding-top: 3px; /* Réduit de 5px à 3px */
    margin: 3px 0; /* Réduit de 5px 0 à 3px 0 */
    font-size: 8pt; /* Réduit de 8.5pt à 8pt */
}
.info-row { 
    display: flex; 
    margin-bottom: 1px; /* Réduit de 3px à 1px pour rapprocher les lignes */
}
.info-item { 
    display: flex; 
    align-items: flex-end; 
    margin-right: 10px; 
    flex-grow: 1; 
}
.info-item p { 
    margin: 0 5px 0 0; 
    white-space: nowrap; 
}
.line { 
    border-bottom: 1px dashed black; 
    flex-grow: 1; 
    height: 8pt; /* Réduit de 9pt à 8pt */
}
.full-line { 
    flex-grow: 1; 
}
  .title-line { text-align: center; font-weight: bold; font-size: 9pt; margin: 3px 0; text-transform: uppercase; }
  
  /* Tableau : La zone la plus importante à optimiser */
  table { 
      border-collapse: collapse; 
      width: 100%; 
      font-size: 6.8pt; /* Réduit à 6.8pt (était 7.5pt) pour compacter */
      text-align: center; 
      table-layout: fixed; 
      margin-bottom: 3px; 
  }
  th, td { 
      border: 1px solid #000; 
      padding: 0.5mm 0.3mm; /* Réduit le padding interne des cellules (était 1mm 0.5mm) */
      word-wrap: break-word; 
      height: auto; /* IMPORTANT : Retire le height: 6mm fixe pour laisser les lignes se compresser */
  }
  th { background:#eee; font-weight: bold; }
  
  /* Styles pour l'en-tête à 4 niveaux */
  .header-title { background: #ccc; font-size: 7.5pt; } 
  .header-sem { background: #ddd; }
  .section-title { font-weight: bold; background:#f0f0f0; text-align: left; }
  .section-title td:first-child { text-align: left; }
  
  /* Notes et totaux */
  .note-rouge { color:red; font-weight:bold; }
  .total-row td { font-weight: bold; background: #eee; }
  .branch-cell { text-align:left; padding-left: 2mm; }
  
  /* Pied de page */
  .footer-section { display: flex; justify-content: space-between; margin-top: 3px; font-size: 7pt; } /* Réduit font-size (était 8pt) */
  .footer-left { width: 55%; line-height: 1.1; }
  .footer-right { width: 40%; text-align: right; }
  .decision-box { border: 1px solid black; padding: 2px; margin-bottom: 3px; text-align: left; }
  .decision-title { font-weight: bold; text-decoration: underline; text-align: center; margin: 0; }
  .signature-line { display: flex; justify-content: space-between; margin-top: 3px; }
  .signature-line p { margin: 0; }
  .chefetab-sig { margin-top: 10px; }
  </style>
</head>
<body>
<div class="bulletin">

    {# --- EN-TÊTE --- #}
    <div class="header">
        <div class="logo-left">
            <img src="{{ drapeau }}" alt="Drapeau RDC">
        </div>
    
        <div class="header-text">
            <h1>RÉPUBLIQUE DÉMOCRATIQUE DU CONGO</h1>
            <h2>MINISTÈRE DE L’ENSEIGNEMENT PRIMAIRE, SECONDAIRE ET PROFESSIONNEL</h2>
            <h3>ÉCOLE : {{ school.nom }}</h3>
            <h4>Année scolaire : {{ school.annee_scolaire }}</h4>
        </div>
    
        <div class="logo-right">
            <img src="{{ sceau }}" alt="Sceau">
        </div>
    </div>
    
    <div class="info-block">
      <div class="info-row">
          <div class="info-item" style="width: 30%;">
              <p>N° ID.</p>
              <div class="line"></div>
          </div>
          <div class="info-item full-line">
              <p>PROVINCE</p>
              <div class="line">{{ school.province.nom|default:"..." }}</div>
          </div>
      </div>
      <div class="info-row">
          <div class="info-item" style="width: 25%;">
              <p>VILLE</p>
              <div class="line">{{ eleve.city.nom|default:"..." }}</div>
          </div>
          <div class="info-item" style="width: 50%;">
              <p>ÉLÈVE</p>
              <div class="line">{{ eleve.nom|upper }}</div>
          </div>
          <div class="info-item" style="width: 15%;">
              <p>SEXE</p>
              <div class="line">{{ eleve.sexe|default:"-" }}</div>
          </div>
      </div>
      <div class="info-row">
          <div class="info-item" style="width: 25%;">
              <p>COMMUNE/TER</p>
              <div class="line">{{ eleve.commune.nom|default:"..." }}</div>
          </div>
          <div class="info-item" style="width: 35%;">
              <p>NÉ(E) À</p>
              <div class="line">{{ eleve.lieu_naissance|default:"..." }}</div>
          </div>
          <div class="info-item" style="width: 30%;">
              <p>LE</p>
              <div class="line">{{ eleve.date_naissance|date:"d/m/Y"|default:"..." }}</div>
          </div>
      </div>
      <div class="info-row">
          <div class="info-item" style="width: 25%;">
              <p>ÉCOLE</p>
              <div class="line">{{ school.nom }}</div>
          </div>
          <div class="info-item" style="width: 35%;">
              <p>CLASSE</p>
              <div class="line">{{ classe.nom }}</div>
          </div>
          <div class="info-item" style="width: 30%;">
              <p>N° PERM.</p>
              <div class="line">[ _ _ _ _ _ _ ]</div>
          </div>
      </div>
      <div class="info-row" style="justify-content: flex-end; margin-top: 3px;">
           <div class="info-item" style="width: 25%;">
              <p>CODE</p>
              <div class="line">[ _ _ _ _ _ _ ]</div>
          </div>
      </div>
  </div>
    
    <div class="title-line">
        Bulletin de la classe de {{ classe.nom }} — Année scolaire {{ school.annee_scolaire }}
    </div>

    <table>
        <thead>
            <tr>
                <th rowspan="4">BRANCHES</th>
                
                {# En-tête de la première ligne : Titre du bulletin (colspan 8 : 4 cols/semestre * 2 semestres) #}
                <th colspan="8" class="header-title">BULLETIN DE {{ classe.nom }} — Année scolaire {{ school.annee_scolaire }}</th>
                
                {# Colonnes finales, toutes en rowspan="4", avec TOT GÉN en premier. #}
                <th rowspan="4">TOT GÉN</th>
                <th rowspan="4" class="header-repa">% EXAMEN DE REPÊCHAGE</th>
                <th rowspan="4" class="header-sign">Sign. Prof</th>
            </tr>
            <tr>
                {# En-tête de la deuxième ligne : Semestres (colspan 4). Pas de TOT GÉN ici. #}
                {% for semestre in semestres %}
                    <th colspan="4" class="header-title">{{ semestre.nom|upper }}</th>
                {% endfor %}
                {# Les trois colonnes suivantes sont couvertes par les rowspan="4" de la première ligne. #}
            </tr>
            <tr>
                {# En-tête de la troisième ligne : Journalier / Total Semestre #}
                {% for semestre in semestres %}
                    <th colspan="3" class="header-sem">JOURNAL.</th>
                    <th rowspan="2" class="header-tot">TOT. SEM.</th>
                {% endfor %}
                {# Les trois colonnes suivantes sont couvertes par les rowspan. #}
            </tr>
            <tr>
                {# En-tête de la quatrième ligne : Noms des Périodes (3 premières seulement) #}
                {% for semestre in semestres %}
                    {% for p in periodes_par_semestre|get_item:semestre %}
                        {# On affiche seulement les 3 premières périodes sous JOURNALIER #}
                        {% if forloop.counter <= 3 %}
                            <th>{{ p.nom }}</th>
                        {% endif %}
                    {% endfor %}
                {% endfor %}
                {# Les cinq colonnes suivantes (2 Tot. Sem. + 3 finales) sont couvertes par les rowspan. #}
            </tr>
        </thead>

        <tbody>
            {# Boucle sur les sections consolidées (groupes de matières) #}
            {% for section in bulletin_sections %}
            
                <tr class="section-title">
                {# Ligne des Maximas de la section #}
                <td>MAXIMA ({{ section.maxima_identifiant|default:'ND' }})</td>
                
                {# Affichage des maximas pour chaque période (3 par semestre) et total semestre (4 colonnes * 2) #}
                {% for semestre in semestres %}
                    {% for p in periodes_par_semestre|get_item:semestre %}
                        {% if forloop.counter <= 3 %}
                            <td>{{ section.maxima_notes_by_periode|get_item:p|default:"-"|floatformat:2 }}</td>
                        {% endif %}
                    {% endfor %}
                    <td>{{ section.maxima_section_totaux|get_item:semestre|floatformat:2 }}</td>
                {% endfor %}
                
                {# Colonnes fixes (3 colonnes) #}
                <td>{{ section.total_general_maxima_section|floatformat:2 }}</td>
                <td>—</td>
                <td>—</td>
                </tr>
            
                {# Lignes des Matières dans la section #}
                {% for matiere in section.matieres_section %}
                    <tr>
                        <td class="branch-cell">{{ matiere.nom }}</td>
                        
                        {# Notes pour chaque période (3 par semestre) et total semestre (4 colonnes * 2) #}
                        {% for semestre in semestres %}
                            {% for p in periodes_par_semestre|get_item:semestre %}
                                {% if forloop.counter <= 3 %}
                                    {% with note=notes_by_matiere|get_item:matiere|get_item:p %}
                                        {% with maxima_val_period=section.maxima_notes_by_periode|get_item:p %} 
                                            {% if note and note.note_obtenue is not None %}
                                                {# Mise en rouge si la note est inférieure à 50% du maxima de la section pour la période #}
                                                {% if maxima_val_period and note.note_obtenue < maxima_val_period|floatdivide:2 %}
                                                    <td class="note-rouge">{{ note.note_obtenue|floatformat:2 }}</td>
                                                {% else %}
                                                    <td>{{ note.note_obtenue|floatformat:2|default:"-" }}</td>
                                                {% endif %}
                                            {% else %}
                                                <td>-</td>
                                            {% endif %}
                                        {% endwith %}
                                    {% endwith %}
                                {% endif %}
                            {% endfor %}
                            
                            {# Total par semestre pour la matière #}
                            {% with total_mat_sem=section.totaux_semestre_par_matiere|get_item:matiere|get_item:semestre %}
                                {% with max_sem=section.maxima_section_totaux|get_item:semestre %}
                                    {# Mise en rouge si le total est inférieur à 50% du maxima du semestre de la section #}
                                    {% if max_sem > 0 and total_mat_sem < max_sem|floatdivide:2 %}
                                        <td class="note-rouge">{{ total_mat_sem|floatformat:2 }}</td>
                                    {% else %}
                                        <td>{{ total_mat_sem|floatformat:2 }}</td>
                                    {% endif %}
                                {% endwith %}
                            {% endwith %}
                        {% endfor %}
                        
                        {# Total Général pour la matière #}
                        {% with total_global=section.totaux_global_par_matiere|get_item:matiere %}
                            {% with max_tg=section.total_general_maxima_section %}
                                {# Mise en rouge si le total général est inférieur à 50% du maxima général de la section #}
                                {% if max_tg > 0 and total_global < max_tg|floatdivide:2 %}
                                    <td class="note-rouge">{{ total_global|floatformat:2 }}</td>
                                {% else %}
                                    <td>{{ total_global|floatformat:2 }}</td>
                                {% endif %}
                            {% endwith %}
                        {% endwith %}
                        
                        <td>—</td>
                        <td>—</td>
                    </tr>
                {% endfor %}
            {% endfor %}
        </tbody>

        <tfoot>
            {# Ligne Maximas généraux (somme de toutes les sections pour la période/semestre/total) #}
            <tr class="total-row">
                <td>MAXIMA GÉNÉRAUX</td>
                
                {# Maxima par période (sauf examen) et par semestre (4 colonnes * 2) #}
                {% for semestre in semestres %}
                    {% for p in periodes_par_semestre|get_item:semestre %}
                        {% if forloop.counter <= 3 %}
                            <td>{{ maxima_generaux|get_item:p|floatformat:2 }}</td>
                        {% endif %}
                    {% endfor %}
                    <td>{{ totaux_semestre|get_item:semestre|floatformat:2 }}</td>
                {% endfor %}
                
                {# Colonnes fixes (3 colonnes) #}
                <td>{{ total_general_attendu|floatformat:2 }}</td>
                <td>—</td>
                <td>—</td>
            </tr>
        
            {# Ligne Totaux obtenus par l'élève #}
            <tr class="total-row">
                <td>TOTAUX</td>
                
                {# Totaux obtenus par période (sauf examen) et par semestre (4 colonnes * 2) #}
                {% for semestre in semestres %}
                    {% for p in periodes_par_semestre|get_item:semestre %}
                        {% if forloop.counter <= 3 %}
                            {# Mise en rouge si Total Période Obtenu est inférieur à 50% du Maxima de la période #}
                            {% if total_periode_obtenu|get_item:p < maxima_generaux|get_item:p|floatdivide:2 %}
                                <td class="note-rouge">{{ total_periode_obtenu|get_item:p|floatformat:2 }}</td>
                            {% else %}
                                <td>{{ total_periode_obtenu|get_item:p|floatformat:2 }}</td>
                            {% endif %}
                        {% endif %}
                    {% endfor %}
                    
                    {# Mise en rouge si Total Semestre Obtenu est inférieur à 50% du Maxima du semestre #}
                    {% if total_semestre_obtenu|get_item:semestre < totaux_semestre|get_item:semestre|floatdivide:2 %}
                        <td class="note-rouge">{{ total_semestre_obtenu|get_item:semestre|floatformat:2 }}</td>
                    {% else %}
                        <td>{{ total_semestre_obtenu|get_item:semestre|floatformat:2 }}</td>
                    {% endif %}
                {% endfor %}
                
                {# Colonnes fixes (3 colonnes) #}
                {# Mise en rouge si Total Général Obtenu est inférieur à 50% du Maxima Général #}
                {% if total_obtenu < total_general_attendu|floatdivide:2 %}
                    <td class="note-rouge">{{ total_obtenu|floatformat:2 }}</td>
                {% else %}
                    <td>{{ total_obtenu|floatformat:2 }}</td>
                {% endif %}
                <td>—</td>
                <td>—</td>
            </tr>
        
            {# Ligne Pourcentage #}
            <tr class="total-row">
                <td>POURCENTAGE</td>
                
                {% for semestre in semestres %}
                    {% for p in periodes_par_semestre|get_item:semestre %}
                        {% if forloop.counter <= 3 %}
                            {# Mise en rouge si Pourcentage Période est inférieur à 50% #}
                            {% if pourcentage_periode|get_item:p < 50 %}
                                <td class="note-rouge">{{ pourcentage_periode|get_item:p|floatformat:2 }} %</td>
                            {% else %}
                                <td>{{ pourcentage_periode|get_item:p|floatformat:2 }} %</td>
                            {% endif %}
                        {% endif %}
                    {% endfor %}
                    
                    {# Mise en rouge si Pourcentage Semestre est inférieur à 50% #}
                    {% if pourcentage_semestre|get_item:semestre < 50 %}
                        <td class="note-rouge">{{ pourcentage_semestre|get_item:semestre|floatformat:2 }} %</td>
                    {% else %}
                        <td>{{ pourcentage_semestre|get_item:semestre|floatformat:2 }} %</td>
                    {% endif %}
                {% endfor %}
                
                {# Colonnes fixes (3 colonnes) #}
                {# Mise en rouge si Pourcentage Total est inférieur à 50% #}
                {% if pourcentage_total < 50 %}
                    <td class="note-rouge">{{ pourcentage_total|floatformat:2 }} %</td>
                {% else %}
                    <td>{{ pourcentage_total|floatformat:2 }} %</td>
                {% endif %}
                <td>—</td>
                <td>—</td>
            </tr>
        
            {# Ligne Place (Rang) #}
            <tr class="total-row">
                <td>PLACE / NBRE ÉLÈVES</td>
                
                {% for semestre in semestres %}
                    {% for p in periodes_par_semestre|get_item:semestre %}
                        {% if forloop.counter <= 3 %}
                            <td>{{ rang_par_periode|get_item:p|default:"—" }}</td>
                        {% endif %}
                    {% endfor %}
                    <td>{{ rang_par_semestre|get_item:semestre|default:"—" }}</td>
                {% endfor %}
                
                {# Colonnes fixes (3 colonnes) #}
                <td>{{ rang_general|default:"—" }}</td>
                <td>—</td>
                <td>—</td>
            </tr>
            
            <tr class="total-row">
                <td>APPLICATION / CONDUITE</td>
                {# 11 cellules vides pour les colonnes de données (3 P + 1 TS) * 2 Sem + 1 TG + 1 Rep + 1 Sign = 11 colonnes #}
                {% for i in "1"|rjust:11 %}<td></td>{% endfor %}
            </tr>
            <tr class="total-row">
                <td>SIGN. RESPONSABLE</td>
                {% for i in "1"|rjust:11 %}<td></td>{% endfor %}
            </tr>
        </tfoot>
        
    </table>
    
    <div class="footer-section">
        <div class="footer-left">
            <p>--- L'élève ne pourra pas accéder à la classe supérieure s'il n'a pas réussi avec succès un examen de repêchage en</p>
            <p style="border-bottom: 1px solid black; margin-top: 5px;">&nbsp;</p>
            <p style="margin-top: 5px;">( ) s'il(elle) passe dans la classe supérieure</p>
            <p>( ) s'il(elle) redouble la classe</p>
            <p>( ) s'il(elle) est exclu par le Conseil des Professeurs</p>
            
            <div class="signature-line" style="margin-top: 15px;">
                <p>Signature des parents</p>
                <p>Signature de l'élève</p>
            </div>
            
            <p style="margin-top: 5px;">*Note importante* : Le bulletin est sans valeur s'il est raturé ou surchargé</p>
        </div>
        
        <div class="footer-right">
            <div class="decision-box">
                <p class="decision-title">Décision</p>
                <p>- Passe - Double ( )</p>
                <p>- A échoué ( )</p>
            </div>
            <div class="signature-line right-aligned" style="justify-content: flex-end;">
                <p>Fait à .................................................., le ...... / ...... / 20.....</p>
            </div>
            <div class="chefetab-sig">
                <p>Le Chef d'établissement,</p>
                <p style="margin-top: 20px;">_________________________</p>
            </div>
        </div>
    </div>
    
</div>
</body>
</html>    {% endcomment %}

{% comment %} {% load custom_tags %}
{% load static %}
<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Bulletin de {{ eleve.nom }}</title>
<style>
  body { font-family: "Times New Roman", serif; background:#fff; color:#000; margin:0; padding:0; }
  .bulletin { width:190mm; margin:10mm auto; border:2px solid #000; padding:5mm; box-sizing:border-box; }
  .header { display:flex; justify-content:space-between; align-items:center; border-bottom:2px solid #000; padding-bottom:4px; margin-bottom:5mm; }
  .logo-left, .logo-right { width:30mm; }
  .logo-left img, .logo-right img { max-height:25mm; display:block; margin:0 auto; }
  .header-text { flex:1; text-align:center; font-size:12px; }
  .header-text h1,h2,h3,h4 { margin:2px 0; }
  .info { display:grid; grid-template-columns:repeat(2,1fr); gap:2mm; font-size:11px; margin-bottom:5mm; }
  table { border-collapse:collapse; width:100%; font-size:10px; text-align:center; table-layout:fixed; }
  th,td { border:1px solid #000; padding:1mm; word-wrap:break-word; }
  th { background:#eee; font-weight:bold; }
  .section-title { font-weight:bold; background:#f5f5f5; text-align:left; }
  .signatures { display:flex; justify-content:space-between; margin-top:8mm; font-size:10px; }
  .signature-box { width:30%; text-align:center; }
  .note { font-size:9px; margin-top:5mm; }
  .center { text-align:center; }
  .note-rouge { color:red; font-weight:bold; }
</style>
</head>
<body>
<div class="bulletin">

    <div class="header">
        <div class="logo-left">
            <img src="{{ drapeau }}" alt="Drapeau RDC">
        </div>
        <div class="header-text">
            <h1>RÉPUBLIQUE DÉMOCRATIQUE DU CONGO</h1>
            <h2>MINISTÈRE DE L’ENSEIGNEMENT PRIMAIRE, SECONDAIRE ET PROFESSIONNEL</h2>
            <h3>ÉCOLE : {{ school.nom }} — Année scolaire : {{ school.annee_scolaire }}</h3>
            <h4>Classe : {{ classe.nom }}</h4>
            <h4>Élève : {{ eleve.nom }}</h4>
        </div>
        <div class="logo-right">
            <img src="{{ sceau }}" alt="Sceau">
        </div>
    </div>    

    <div class="info">
      <div>ÉCOLE : {{ school.nom }}</div>
      <div>ÉLÈVE : {{ eleve.nom }} SEXE : {{ eleve.sexe|default:"-" }}</div>
      <div>VILLE : {{ eleve.city.nom|default:"-" }}</div>
      <div>NÉ(E) À : {{ eleve.lieu_naissance|default:"-" }} le {{ eleve.date_naissance|date:"d/m/Y" }}</div>
      <div>COMMUNE/TER : {{ eleve.commune.nom|default:"-" }}</div>
      <div>CLASSE : {{ classe.nom }}</div>
      <div>CODE : [ _ _ _ _ _ _ ]</div>
      <div>N° PERM. : [ _ _ _ _ _ _ ]</div>
    </div>

    <h3 class="center">BULLETIN DE — ANNÉE SCOLAIRE {{ school.annee_scolaire }}</h3>
    
    <table>
      <thead>
        <tr>
          <th rowspan="2">BRANCHES</th>
          {% for semestre in semestres %}
            <th colspan="{{ periodes_par_semestre|get_item:semestre|length|add:'1' }}">{{ semestre.nom }}</th>
          {% endfor %}
          <th rowspan="2">TOT GÉN</th>
          <th rowspan="2">% EXAMEN DE REPÊCHAGE</th>
          <th rowspan="2">Sign. Prof</th>
        </tr>
        <tr>
          {% for semestre in semestres %}
            {% for p in periodes_par_semestre|get_item:semestre %}
              <th>{{ p.nom }}</th>
            {% endfor %}
            <th>Tot Sem</th>
          {% endfor %}
        </tr>
      </thead>

      <tbody>
        <!-- MAXIMA par période -->
        <tr class="section-title">
          <td>MAXIMA</td>
          {% for semestre in semestres %}
            {% for p in periodes_par_semestre|get_item:semestre %}
              <td>{{ maxima_by_periode|get_item:p|default:"-" }}</td>
            {% endfor %}
            <td>{{ totsem_maxima|get_item:semestre|floatformat:2 }}</td>
          {% endfor %}
          <td>{{ total_maxima_general|floatformat:2 }}</td>
          <td>—</td>
          <td>—</td>
        </tr>

        <!-- MATIERES -->
        {% for matiere in matieres %}
        <tr>
          <td>{{ matiere.nom }}</td>
          {% for semestre in semestres %}
            {% for p in periodes_par_semestre|get_item:semestre %}
              {% with note=notes_by_matiere|get_item:matiere|get_item:p %}
                {% if note and note.note_obtenue %}
                  {% if notes_rouge|get_item:matiere|get_item:p %}
                    <td class="note-rouge">{{ note.note_obtenue }}</td>
                  {% else %}
                    <td>{{ note.note_obtenue }}</td>
                  {% endif %}
                {% else %}
                  <td>-</td>
                {% endif %}
              {% endwith %}
            {% endfor %}
            {% with total_mat_sem=tot_matieres_semestre|get_item:matiere|get_item:semestre %}
              {% if totaux_semestre_rouge|get_item:semestre %}
                <td class="note-rouge">{{ total_mat_sem|floatformat:2 }}</td>
              {% else %}
                <td>{{ total_mat_sem|floatformat:2 }}</td>
              {% endif %}
            {% endwith %}
          {% endfor %}
          {% with total_global=tot_matieres_global|get_item:matiere %}
            {% if totaux_matiere_rouge|get_item:matiere %}
              <td class="note-rouge">{{ total_global|floatformat:2 }}</td>
            {% else %}
              <td>{{ total_global|floatformat:2 }}</td>
            {% endif %}
          {% endwith %}
          <td>—</td>
          <td>—</td>
        </tr>
        {% endfor %}
      </tbody>

      <tfoot>
        <!-- Maximas généraux -->
        <tr class="section-title">
          <td>Maximas généraux :</td>
          {% for semestre in semestres %}
            {% for p in periodes_par_semestre|get_item:semestre %}
              <td>{{ maxima_generaux|get_item:p|floatformat:2 }}</td>
            {% endfor %}
            <td>{{ totaux_semestre|get_item:semestre|floatformat:2 }}</td>
          {% endfor %}
          <td>{{ total_general_attendu|floatformat:2 }}</td>
          <td>{{ pourcentage_total|floatformat:2 }} %</td>
          <td>—</td>
        </tr>
      
        <!-- Totaux matières par période -->
        <tr class="section-title">
          <td>Totaux matières :</td>
          {% for semestre in semestres %}
            {% for p in periodes_par_semestre|get_item:semestre %}
              {% if total_periode_obtenu|get_item:p < maxima_generaux|get_item:p|divisibleby:2 %}
                <td class="note-rouge">{{ total_periode_obtenu|get_item:p|floatformat:2 }}</td>
              {% else %}
                <td>{{ total_periode_obtenu|get_item:p|floatformat:2 }}</td>
              {% endif %}
            {% endfor %}
            {% with sem_total=total_semestre_obtenu|get_item:semestre %}
              {% if totaux_semestre_rouge|get_item:semestre %}
                <td class="note-rouge">{{ sem_total|floatformat:2 }}</td>
              {% else %}
                <td>{{ sem_total|floatformat:2 }}</td>
              {% endif %}
            {% endwith %}
          {% endfor %}
          {% if total_general_rouge %}
            <td class="note-rouge">{{ total_obtenu|floatformat:2 }}</td>
          {% else %}
            <td>{{ total_obtenu|floatformat:2 }}</td>
          {% endif %}
          <td>—</td>
          <td>—</td>
        </tr>
      
        <!-- Pourcentage par période -->
        <tr class="section-title">
          <td>Pourcentage périodique :</td>
          {% for semestre in semestres %}
            {% for p in periodes_par_semestre|get_item:semestre %}
              <td>{{ pourcentage_periode|get_item:p|floatformat:2 }} %</td>
            {% endfor %}
            <td>{{ pourcentage_semestre|get_item:semestre|floatformat:2 }} %</td>
          {% endfor %}
          <td>{{ pourcentage_total|floatformat:2 }} %</td>
          <td>—</td>
          <td>—</td>
        </tr>
      
        <!-- Place / Nombre d'élèves -->
        <tr class="section-title">
          <td>Place / Nbre élèves :</td>
          {% for semestre in semestres %}
            {% for p in periodes_par_semestre|get_item:semestre %}
              <td>{{ rang_par_periode|get_item:p|default:"—" }}</td>
            {% endfor %}
            <td>{{ rang_par_semestre|get_item:semestre|default:"—" }}</td>
          {% endfor %}
          <td>{{ rang_general|default:"—" }}</td>
          <td>—</td>
          <td>—</td>
        </tr>
      </tfoot>
      
    </table>
      
    <div class="signatures">
      <div class="signature-box">
        Signature de l’élève <br><br> __________________
      </div>
      <div class="signature-box">
        Sceau de l’école
      </div>
      <div class="signature-box">
        Le Chef d’établissement <br><br> __________________
      </div>
    </div>

    <div class="note">
      * L’élève passe dans la classe supérieure si la moyenne générale est ≥ 50 %. <br>
      * L’élève ne pourra passer dans la classe supérieure s’il n’a subi un examen de repêchage. <br>
      * Ce bulletin est sans valeur s’il est raturé ou surchargé. <br>
      <br>
      Fait à .................................................., le ...... / ...... / 20.....
    </div>

</div>
</body>
</html> {% endcomment %}


{% comment %} {% load custom_tags %}
{% load static %}
<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Bulletin de {{ eleve.nom }}</title>
<style>
  body { font-family: "Times New Roman", serif; background:#fff; color:#000; margin:0; padding:0; }
  .bulletin { width:190mm; margin:10mm auto; border:2px solid #000; padding:5mm; box-sizing:border-box; }
  .header { display:flex; justify-content:space-between; align-items:center; border-bottom:2px solid #000; padding-bottom:4px; margin-bottom:5mm; }
  .logo-left, .logo-right { width:30mm; }
  .logo-left img, .logo-right img { max-height:25mm; display:block; margin:0 auto; }
  .header-text { flex:1; text-align:center; font-size:12px; }
  .header-text h1,h2,h3,h4 { margin:2px 0; }
  .info { display:grid; grid-template-columns:repeat(2,1fr); gap:2mm; font-size:11px; margin-bottom:5mm; }
  table { border-collapse:collapse; width:100%; font-size:10px; text-align:center; table-layout:fixed; }
  th,td { border:1px solid #000; padding:1mm; word-wrap:break-word; }
  th { background:#eee; font-weight:bold; }
  .section-title { font-weight:bold; background:#f5f5f5; text-align:left; }
  .signatures { display:flex; justify-content:space-between; margin-top:8mm; font-size:10px; }
  .signature-box { width:30%; text-align:center; }
  .note { font-size:9px; margin-top:5mm; }
  .center { text-align:center; }
  .note-rouge { color:red; font-weight:bold; }
</style>
</head>
<body>
<div class="bulletin">

    <div class="header">
        <div class="logo-left">
            <img src="{{ drapeau }}" alt="Drapeau RDC">
        </div>
        <div class="header-text">
            <h1>RÉPUBLIQUE DÉMOCRATIQUE DU CONGO</h1>
            <h2>MINISTÈRE DE L’ENSEIGNEMENT PRIMAIRE, SECONDAIRE ET PROFESSIONNEL</h2>
            <h3>ÉCOLE : {{ school.nom }} — Année scolaire : {{ school.annee_scolaire }}</h3>
            <h4>Classe : {{ classe.nom }}</h4>
            <h4>Élève : {{ eleve.nom }}</h4>
        </div>
        <div class="logo-right">
            <img src="{{ sceau }}" alt="Sceau">
        </div>
    </div>    

    <div class="info">
      <div>ÉCOLE : {{ school.nom }}</div>
      <div>ÉLÈVE : {{ eleve.nom }} SEXE : {{ eleve.sexe|default:"-" }}</div>
      <div>VILLE : {{ eleve.city.nom|default:"-" }}</div>
      <div>NÉ(E) À : {{ eleve.lieu_naissance|default:"-" }} le {{ eleve.date_naissance|date:"d/m/Y" }}</div>
      <div>COMMUNE/TER : {{ eleve.commune.nom|default:"-" }}</div>
      <div>CLASSE : {{ classe.nom }}</div>
      <div>CODE : [ _ _ _ _ _ _ ]</div>
      <div>N° PERM. : [ _ _ _ _ _ _ ]</div>
    </div>

    <h3 class="center">BULLETIN DE — ANNÉE SCOLAIRE {{ school.annee_scolaire }}</h3>
    
    <table>
      <thead>
        <tr>
          <th rowspan="2">BRANCHES</th>
          {% for semestre in semestres %}
            <th colspan="{{ periodes_par_semestre|get_item:semestre|length|add:'1' }}">{{ semestre.nom }}</th>
          {% endfor %}
          <th rowspan="2">TOT GÉN</th>
          <th rowspan="2">% EXAMEN DE REPÊCHAGE</th>
          <th rowspan="2">Sign. Prof</th>
        </tr>
        <tr>
          {% for semestre in semestres %}
            {% for p in periodes_par_semestre|get_item:semestre %}
              <th>{{ p.nom }}</th>
            {% endfor %}
            <th>Tot Sem</th>
          {% endfor %}
        </tr>
      </thead>

      <tbody>
        <!-- MAXIMA par période -->
        <tr class="section-title">
          <td>MAXIMA</td>
          {% for semestre in semestres %}
            {% for p in periodes_par_semestre|get_item:semestre %}
              <td>{{ maxima_by_periode|get_item:p|default:"-" }}</td>
            {% endfor %}
            <td>{{ totsem_maxima|get_item:semestre|floatformat:2 }}</td>
          {% endfor %}
          <td>{{ total_maxima_general|floatformat:2 }}</td>
          <td>—</td>
          <td>—</td>
        </tr>

        <!-- MATIERES -->
        {% for matiere in matieres %}
        <tr>
          <td>{{ matiere.nom }}</td>
          {% for semestre in semestres %}
            {% for p in periodes_par_semestre|get_item:semestre %}
              {% with note=notes_by_matiere|get_item:matiere|get_item:p %}
                {% if note and note.note_obtenue %}
                  {% if notes_rouge|get_item:matiere|get_item:p %}
                    <td class="note-rouge">{{ note.note_obtenue }}</td>
                  {% else %}
                    <td>{{ note.note_obtenue }}</td>
                  {% endif %}
                {% else %}
                  <td>-</td>
                {% endif %}
              {% endwith %}
            {% endfor %}
            {% with total_mat_sem=tot_matieres_semestre|get_item:matiere|get_item:semestre %}
              {% if totaux_semestre_rouge|get_item:semestre %}
                <td class="note-rouge">{{ total_mat_sem|floatformat:2 }}</td>
              {% else %}
                <td>{{ total_mat_sem|floatformat:2 }}</td>
              {% endif %}
            {% endwith %}
          {% endfor %}
          {% with total_global=tot_matieres_global|get_item:matiere %}
            {% if totaux_matiere_rouge|get_item:matiere %}
              <td class="note-rouge">{{ total_global|floatformat:2 }}</td>
            {% else %}
              <td>{{ total_global|floatformat:2 }}</td>
            {% endif %}
          {% endwith %}
          <td>—</td>
          <td>—</td>
        </tr>
        {% endfor %}
      </tbody>

      <tfoot>
        <!-- Maximas généraux -->
        <tr class="section-title">
          <td>Maximas généraux :</td>
          {% for semestre in semestres %}
            {% for p in periodes_par_semestre|get_item:semestre %}
              <td>{{ maxima_generaux|get_item:p|floatformat:2 }}</td>
            {% endfor %}
            <td>{{ totaux_semestre|get_item:semestre|floatformat:2 }}</td>
          {% endfor %}
          <td>{{ total_general_attendu|floatformat:2 }}</td>
          <td>{{ pourcentage_total|floatformat:2 }} %</td>
          <td>—</td>
        </tr>
      
        <!-- Totaux matières par période -->
        <tr class="section-title">
          <td>Totaux matières :</td>
          {% for semestre in semestres %}
            {% for p in periodes_par_semestre|get_item:semestre %}
              {% if notes_rouge|get_item:p %}
                <td class="note-rouge">{{ total_periode_obtenu|get_item:p|floatformat:2 }}</td>
              {% else %}
                <td>{{ total_periode_obtenu|get_item:p|floatformat:2 }}</td>
              {% endif %}
            {% endfor %}
            {% with sem_total=total_semestre_obtenu|get_item:semestre %}
              {% if totaux_semestre_rouge|get_item:semestre %}
                <td class="note-rouge">{{ sem_total|floatformat:2 }}</td>
              {% else %}
                <td>{{ sem_total|floatformat:2 }}</td>
              {% endif %}
            {% endwith %}
          {% endfor %}
          {% if total_general_rouge %}
            <td class="note-rouge">{{ total_obtenu|floatformat:2 }}</td>
          {% else %}
            <td>{{ total_obtenu|floatformat:2 }}</td>
          {% endif %}
          <td>—</td>
          <td>—</td>
        </tr>
      
        <!-- Pourcentage par période -->
        <tr class="section-title">
          <td>Pourcentage périodique :</td>
          {% for semestre in semestres %}
            {% for p in periodes_par_semestre|get_item:semestre %}
              <td>{{ pourcentage_periode|get_item:p|floatformat:2 }} %</td>
            {% endfor %}
            <td>{{ pourcentage_semestre|get_item:semestre|floatformat:2 }} %</td>
          {% endfor %}
          <td>{{ pourcentage_total|floatformat:2 }} %</td>
          <td>—</td>
          <td>—</td>
        </tr>
      
        <!-- Place / Nombre d'élèves -->
        <tr class="section-title">
          <td>Place / Nbre élèves :</td>
          {% for semestre in semestres %}
            {% for p in periodes_par_semestre|get_item:semestre %}
              <td>{{ rang_par_periode|get_item:p|default:"—" }}</td>
            {% endfor %}
            <td>{{ rang_par_semestre|get_item:semestre|default:"—" }}</td>
          {% endfor %}
          <td>{{ rang_general|default:"—" }}</td>
          <td>—</td>
          <td>—</td>
        </tr>
      </tfoot>
      
    </table>
      
    <div class="signatures">
      <div class="signature-box">
        Signature de l’élève <br><br> __________________
      </div>
      <div class="signature-box">
        Sceau de l’école
      </div>
      <div class="signature-box">
        Le Chef d’établissement <br><br> __________________
      </div>
    </div>

    <div class="note">
      * L’élève passe dans la classe supérieure si la moyenne générale est ≥ 50 %. <br>
      * L’élève ne pourra passer dans la classe supérieure s’il n’a subi un examen de repêchage. <br>
      * Ce bulletin est sans valeur s’il est raturé ou surchargé. <br>
      <br>
      Fait à .................................................., le ...... / ...... / 20.....
    </div>

</div>
</body>
</html> {% endcomment %}


{% comment %} {% load custom_tags %}
{% load static %}
<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Bulletin de {{ eleve.nom }}</title>
<style>
  body { font-family: "Times New Roman", serif; background:#fff; color:#000; margin:0; padding:0; }
  .bulletin { width:190mm; margin:10mm auto; border:2px solid #000; padding:5mm; box-sizing:border-box; }
  .header { display:flex; justify-content:space-between; align-items:center; border-bottom:2px solid #000; padding-bottom:4px; margin-bottom:5mm; }
  .logo-left, .logo-right { width:30mm; }
  .logo-left img, .logo-right img { max-height:25mm; display:block; margin:0 auto; }
  .header-text { flex:1; text-align:center; font-size:12px; }
  .header-text h1,h2,h3,h4 { margin:2px 0; }
  .info { display:grid; grid-template-columns:repeat(2,1fr); gap:2mm; font-size:11px; margin-bottom:5mm; }
  table { border-collapse:collapse; width:100%; font-size:10px; text-align:center; table-layout:fixed; }
  th,td { border:1px solid #000; padding:1mm; word-wrap:break-word; }
  th { background:#eee; font-weight:bold; }
  .section-title { font-weight:bold; background:#f5f5f5; text-align:left; }
  .signatures { display:flex; justify-content:space-between; margin-top:8mm; font-size:10px; }
  .signature-box { width:30%; text-align:center; }
  .note { font-size:9px; margin-top:5mm; }
  .center { text-align:center; }
  .note-rouge { color:red; font-weight:bold; }
</style>
</head>
<body>
<div class="bulletin">

    <div class="header">
        <div class="logo-left">
            <img src="{{ drapeau }}" alt="Drapeau RDC">
        </div>
        <div class="header-text">
            <h1>RÉPUBLIQUE DÉMOCRATIQUE DU CONGO</h1>
            <h2>MINISTÈRE DE L’ENSEIGNEMENT PRIMAIRE, SECONDAIRE ET PROFESSIONNEL</h2>
            <h3>ÉCOLE : {{ school.nom }} — Année scolaire : {{ school.annee_scolaire }}</h3>
            <h4>Classe : {{ classe.nom }}</h4>
            <h4>Élève : {{ eleve.nom }}</h4>
        </div>
        <div class="logo-right">
            <img src="{{ sceau }}" alt="Sceau">
        </div>
    </div>    

    <div class="info">
      <div>ÉCOLE : {{ school.nom }}</div>
      <div>ÉLÈVE : {{ eleve.nom }} SEXE : {{ eleve.sexe|default:"-" }}</div>
      <div>VILLE : {{ eleve.city.nom|default:"-" }}</div>
      <div>NÉ(E) À : {{ eleve.lieu_naissance|default:"-" }} le {{ eleve.date_naissance|date:"d/m/Y" }}</div>
      <div>COMMUNE/TER : {{ eleve.commune.nom|default:"-" }}</div>
      <div>CLASSE : {{ classe.nom }}</div>
      <div>CODE : [ _ _ _ _ _ _ ]</div>
      <div>N° PERM. : [ _ _ _ _ _ _ ]</div>
    </div>

    <h3 class="center">BULLETIN DE — ANNÉE SCOLAIRE {{ school.annee_scolaire }}</h3>
    
    <table>
      <thead>
        <tr>
          <th rowspan="2">BRANCHES</th>
          {% for semestre in semestres %}
            <th colspan="{{ periodes_par_semestre|get_item:semestre|length|add:'1' }}">{{ semestre.nom }}</th>
          {% endfor %}
          <th rowspan="2">TOT GÉN</th>
          <th rowspan="2">% EXAMEN DE REPÊCHAGE</th>
          <th rowspan="2">Sign. Prof</th>
        </tr>
        <tr>
          {% for semestre in semestres %}
            {% for p in periodes_par_semestre|get_item:semestre %}
              <th>{{ p.nom }}</th>
            {% endfor %}
            <th>Tot Sem</th>
          {% endfor %}
        </tr>
      </thead>

      <tbody>
        <!-- MAXIMA par période -->
        <tr class="section-title">
          <td>MAXIMA</td>
          {% for semestre in semestres %}
            {% for p in periodes_par_semestre|get_item:semestre %}
              <td>{{ maxima_by_periode|get_item:p|default:"-" }}</td>
            {% endfor %}
            <td>{{ totsem_maxima|get_item:semestre|floatformat:2 }}</td>
          {% endfor %}
          <td>{{ total_maxima_general|floatformat:2 }}</td>
          <td>—</td>
          <td>—</td>
        </tr>

        <!-- MATIERES -->
        {% for matiere in matieres %}
        <tr>
          <td>{{ matiere.nom }}</td>
          {% for semestre in semestres %}
            {% for p in periodes_par_semestre|get_item:semestre %}
              <td>
                {% with note=notes_by_matiere|get_item:matiere|get_item:p %}
                  {% if note and note.note_obtenue %}
                    {% with max_note=maxima_by_periode|get_item:p %}
                      {% if max_note and note.note_obtenue < max_note|floatformat:2|floatval / 2 %}
                        <span class="note-rouge">{{ note.note_obtenue }}</span>
                      {% else %}
                        {{ note.note_obtenue }}
                      {% endif %}
                    {% endwith %}
                  {% else %}
                    -
                  {% endif %}
                {% endwith %}
              </td>
            {% endfor %}
            <td>
              {% with total_mat_sem=tot_matieres_semestre|get_item:matiere|get_item:semestre %}
                {% with max_semestre=totsem_maxima|get_item:semestre %}
                  {% if max_semestre and total_mat_sem < max_semestre / 2 %}
                    <span class="note-rouge">{{ total_mat_sem|floatformat:2 }}</span>
                  {% else %}
                    {{ total_mat_sem|floatformat:2 }}
                  {% endif %}
                {% endwith %}
              {% endwith %}
            </td>
          {% endfor %}
          <td>
            {% with total_global=tot_matieres_global|get_item:matiere %}
              {% if total_global < total_maxima_general / 2 %}
                <span class="note-rouge">{{ total_global|floatformat:2 }}</span>
              {% else %}
                {{ total_global|floatformat:2 }}
              {% endif %}
            {% endwith %}
          </td>
          <td>—</td>
          <td>—</td>
        </tr>
        {% endfor %}
      </tbody>

      <tfoot>
        <!-- Maximas généraux -->
        <tr class="section-title">
          <td>Maximas généraux :</td>
          {% for semestre in semestres %}
            {% for p in periodes_par_semestre|get_item:semestre %}
              <td>{{ maxima_generaux|get_item:p|floatformat:2 }}</td>
            {% endfor %}
            <td>{{ totaux_semestre|get_item:semestre|floatformat:2 }}</td>
          {% endfor %}
          <td>{{ total_general_attendu|floatformat:2 }}</td>
          <td>{{ pourcentage_total|floatformat:2 }} %</td>
          <td>—</td>
        </tr>
      
        <!-- Totaux matières par période -->
        <tr class="section-title">
          <td>Totaux matières :</td>
          {% for semestre in semestres %}
            {% for p in periodes_par_semestre|get_item:semestre %}
              {% with total=total_periode_obtenu|get_item:p %}
                {% with max_total=maxima_generaux|get_item:p %}
                  {% if max_total and total < max_total / 2 %}
                    <td class="note-rouge">{{ total|floatformat:2 }}</td>
                  {% else %}
                    <td>{{ total|floatformat:2 }}</td>
                  {% endif %}
                {% endwith %}
              {% endwith %}
            {% endfor %}
            {% with sem_total=total_semestre_obtenu|get_item:semestre %}
              {% with max_sem=totsem_maxima|get_item:semestre %}
                {% if max_sem and sem_total < max_sem / 2 %}
                  <td class="note-rouge">{{ sem_total|floatformat:2 }}</td>
                {% else %}
                  <td>{{ sem_total|floatformat:2 }}</td>
                {% endif %}
              {% endwith %}
            {% endwith %}
          {% endfor %}
          {% if total_obtenu < total_maxima_general / 2 %}
            <td class="note-rouge">{{ total_obtenu|floatformat:2 }}</td>
          {% else %}
            <td>{{ total_obtenu|floatformat:2 }}</td>
          {% endif %}
          <td>—</td>
          <td>—</td>
        </tr>
      
        <!-- Pourcentage par période -->
        <tr class="section-title">
          <td>Pourcentage périodique :</td>
          {% for semestre in semestres %}
            {% for p in periodes_par_semestre|get_item:semestre %}
              <td>{{ pourcentage_periode|get_item:p|floatformat:2 }} %</td>
            {% endfor %}
            <td>{{ pourcentage_semestre|get_item:semestre|floatformat:2 }} %</td>
          {% endfor %}
          <td>{{ pourcentage_total|floatformat:2 }} %</td>
          <td>—</td>
          <td>—</td>
        </tr>
      
        <!-- Place / Nombre d'élèves -->
        <tr class="section-title">
          <td>Place / Nbre élèves :</td>
          {% for semestre in semestres %}
            {% for p in periodes_par_semestre|get_item:semestre %}
              <td>{{ rang_par_periode|get_item:p|default:"—" }}</td>
            {% endfor %}
            <td>{{ rang_par_semestre|get_item:semestre|default:"—" }}</td>
          {% endfor %}
          <td>{{ rang_general|default:"—" }}</td>
          <td>—</td>
          <td>—</td>
        </tr>
      </tfoot>
      
    </table>
      
    <div class="signatures">
      <div class="signature-box">
        Signature de l’élève <br><br> __________________
      </div>
      <div class="signature-box">
        Sceau de l’école
      </div>
      <div class="signature-box">
        Le Chef d’établissement <br><br> __________________
      </div>
    </div>

    <div class="note">
      * L’élève passe dans la classe supérieure si la moyenne générale est ≥ 50 %. <br>
      * L’élève ne pourra passer dans la classe supérieure s’il n’a subi un examen de repêchage. <br>
      * Ce bulletin est sans valeur s’il est raturé ou surchargé. <br>
      <br>
      Fait à .................................................., le ...... / ...... / 20.....
    </div>

</div>
</body>
</html> {% endcomment %}


{% comment %} {% load custom_tags %}
{% load static %}
<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Bulletin de {{ eleve.nom }}</title>
<style>
  body { font-family: "Times New Roman", serif; background:#fff; color:#000; margin:0; padding:0; }
  .bulletin { width:190mm; margin:10mm auto; border:2px solid #000; padding:5mm; box-sizing:border-box; }
  .header { display:flex; justify-content:space-between; align-items:center; border-bottom:2px solid #000; padding-bottom:4px; margin-bottom:5mm; }
  .logo-left, .logo-right { width:30mm; }
  .logo-left img, .logo-right img { max-height:25mm; display:block; margin:0 auto; }
  .header-text { flex:1; text-align:center; font-size:12px; }
  .header-text h1,h2,h3,h4 { margin:2px 0; }
  .info { display:grid; grid-template-columns:repeat(2,1fr); gap:2mm; font-size:11px; margin-bottom:5mm; }
  table { border-collapse:collapse; width:100%; font-size:10px; text-align:center; table-layout:fixed; }
  th,td { border:1px solid #000; padding:1mm; word-wrap:break-word; }
  th { background:#eee; font-weight:bold; }
  .section-title { font-weight:bold; background:#f5f5f5; text-align:left; }
  .signatures { display:flex; justify-content:space-between; margin-top:8mm; font-size:10px; }
  .signature-box { width:30%; text-align:center; }
  .note { font-size:9px; margin-top:5mm; }
  .center { text-align:center; }
</style>
</head>
<body>
<div class="bulletin">

    <div class="header">
        <div class="logo-left">
            <img src="{{ drapeau }}" alt="Drapeau RDC">
        </div>
        <div class="header-text">
            <h1>RÉPUBLIQUE DÉMOCRATIQUE DU CONGO</h1>
            <h2>MINISTÈRE DE L’ENSEIGNEMENT PRIMAIRE, SECONDAIRE ET PROFESSIONNEL</h2>
            <h3>ÉCOLE : {{ school.nom }} — Année scolaire : {{ school.annee_scolaire }}</h3>
            <h4>Classe : {{ classe.nom }}</h4>
            <h4>Élève : {{ eleve.nom }}</h4>
        </div>
        <div class="logo-right">
            <img src="{{ sceau }}" alt="Sceau">
        </div>
    </div>    

    <div class="info">
      <div>ÉCOLE : {{ school.nom }}</div>
      <div>ÉLÈVE : {{ eleve.nom }} SEXE : {{ eleve.sexe|default:"-" }}</div>
      <div>VILLE : {{ eleve.city.nom|default:"-" }}</div>
      <div>NÉ(E) À : {{ eleve.lieu_naissance|default:"-" }} le {{ eleve.date_naissance|date:"d/m/Y" }}</div>
      <div>COMMUNE/TER : {{ eleve.commune.nom|default:"-" }}</div>
      <div>CLASSE : {{ classe.nom }}</div>
      <div>CODE : [ _ _ _ _ _ _ ]</div>
      <div>N° PERM. : [ _ _ _ _ _ _ ]</div>
    </div>

    <h3 class="center">BULLETIN DE — ANNÉE SCOLAIRE {{ school.annee_scolaire }}</h3>
    
    <table>
      <thead>
        <tr>
          <th rowspan="2">BRANCHES</th>
          {% for semestre in semestres %}
            <th colspan="{{ periodes_par_semestre|get_item:semestre|length|add:'1' }}">{{ semestre.nom }}</th>
          {% endfor %}
          <th rowspan="2">TOT GÉN</th>
          <th rowspan="2">% EXAMEN DE REPÊCHAGE</th>
          <th rowspan="2">Sign. Prof</th>
        </tr>
        <tr>
          {% for semestre in semestres %}
            {% for p in periodes_par_semestre|get_item:semestre %}
              <th>{{ p.nom }}</th>
            {% endfor %}
            <th>Tot Sem</th>
          {% endfor %}
        </tr>
      </thead>

      <tbody>
        <!-- MAXIMA par période -->
        <tr class="section-title">
          <td>MAXIMA</td>
          {% for semestre in semestres %}
            {% for p in periodes_par_semestre|get_item:semestre %}
              <td>{{ maxima_by_periode|get_item:p|default:"-" }}</td>
            {% endfor %}
            <td>{{ totsem_maxima|get_item:semestre|floatformat:2 }}</td>
          {% endfor %}
          <td>{{ total_maxima_general|floatformat:2 }}</td>
          <td>—</td>
          <td>—</td>
        </tr>

        <!-- MATIERES -->
        {% for matiere in matieres %}
        <tr>
          <td>{{ matiere.nom }}</td>
          {% for semestre in semestres %}
            {% for p in periodes_par_semestre|get_item:semestre %}
              <td>
                {% with notes_by_matiere|get_item:matiere|get_item:p as note %}
                  {{ note.note_obtenue|default:"-" }}
                {% endwith %}
              </td>
            {% endfor %}
            <td>{{ tot_matieres_semestre|get_item:matiere|get_item:semestre|floatformat:2 }}</td>
          {% endfor %}
          <td>{{ tot_matieres_global|get_item:matiere|floatformat:2 }}</td>
          <td>—</td>
          <td>—</td>
        </tr>
        {% endfor %}
      </tbody>

      <tfoot>
        <!-- Maximas généraux -->
        <tr class="section-title">
          <td>Maximas généraux :</td>
          {% for semestre in semestres %}
            {% for p in periodes_par_semestre|get_item:semestre %}
              <td>{{ maxima_generaux|get_item:p|floatformat:2 }}</td>
            {% endfor %}
            <td>{{ totaux_semestre|get_item:semestre|floatformat:2 }}</td>
          {% endfor %}
          <td>{{ total_general_attendu|floatformat:2 }}</td>
          <td>{{ pourcentage_total|floatformat:2 }} %</td>
          <td>—</td>
        </tr>
      
        <!-- Totaux matières par période -->
        <tr class="section-title">
          <td>Totaux matières :</td>
          {% for semestre in semestres %}
            {% for p in periodes_par_semestre|get_item:semestre %}
              <td>{{ total_periode_obtenu|get_item:p|floatformat:2 }}</td>
            {% endfor %}
            <td>{{ total_semestre_obtenu|get_item:semestre|floatformat:2 }}</td>
          {% endfor %}
          <td>{{ total_obtenu|floatformat:2 }}</td>
          <td>—</td>
          <td>—</td>
        </tr>
      
        <!-- Pourcentage par période -->
        <tr class="section-title">
          <td>Pourcentage périodique :</td>
          {% for semestre in semestres %}
            {% for p in periodes_par_semestre|get_item:semestre %}
              <td>{{ pourcentage_periode|get_item:p|floatformat:2 }} %</td>
            {% endfor %}
            <td>{{ pourcentage_semestre|get_item:semestre|floatformat:2 }} %</td>
          {% endfor %}
          <td>{{ pourcentage_total|floatformat:2 }} %</td>
          <td>—</td>
          <td>—</td>
        </tr>
      
        <!-- Place / Nombre d'élèves -->
        <tr class="section-title">
          <td>Place / Nbre élèves :</td>
          {% for semestre in semestres %}
            {% for p in periodes_par_semestre|get_item:semestre %}
              <td>{{ rang_par_periode|get_item:p|default:"—" }}</td>
            {% endfor %}
            <td>{{ rang_par_semestre|get_item:semestre|default:"—" }}</td>
          {% endfor %}
          <td>{{ rang_general|default:"—" }}</td>
          <td>—</td>
          <td>—</td>
        </tr>
      </tfoot>
      
      
      
    </table>
      

    <div class="signatures">
      <div class="signature-box">
        Signature de l’élève <br><br> __________________
      </div>
      <div class="signature-box">
        Sceau de l’école
      </div>
      <div class="signature-box">
        Le Chef d’établissement <br><br> __________________
      </div>
    </div>

    <div class="note">
      * L’élève passe dans la classe supérieure si la moyenne générale est ≥ 50 %. <br>
      * L’élève ne pourra passer dans la classe supérieure s’il n’a subi un examen de repêchage. <br>
      * Ce bulletin est sans valeur s’il est raturé ou surchargé. <br>
      <br>
      Fait à .................................................., le ...... / ...... / 20.....
    </div>

</div>
</body>
</html> {% endcomment %}


{% comment %} {% load custom_tags %}
{% load static %}
<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Bulletin de {{ eleve.nom }}</title>
<style>
  body { font-family: "Times New Roman", serif; background:#fff; color:#000; margin:0; padding:0; }
  .bulletin { width:190mm; margin:10mm auto; border:2px solid #000; padding:5mm; box-sizing:border-box; }
  .header { display:flex; justify-content:space-between; align-items:center; border-bottom:2px solid #000; padding-bottom:4px; margin-bottom:5mm; }
  .logo-left, .logo-right { width:30mm; }
  .logo-left img, .logo-right img { max-height:25mm; display:block; margin:0 auto; }
  .header-text { flex:1; text-align:center; font-size:12px; }
  .header-text h1,h2,h3,h4 { margin:2px 0; }
  .info { display:grid; grid-template-columns:repeat(2,1fr); gap:2mm; font-size:11px; margin-bottom:5mm; }
  table { border-collapse:collapse; width:100%; font-size:10px; text-align:center; table-layout:fixed; }
  th,td { border:1px solid #000; padding:1mm; word-wrap:break-word; }
  th { background:#eee; font-weight:bold; }
  .section-title { font-weight:bold; background:#f5f5f5; text-align:left; }
  .signatures { display:flex; justify-content:space-between; margin-top:8mm; font-size:10px; }
  .signature-box { width:30%; text-align:center; }
  .note { font-size:9px; margin-top:5mm; }
  .center { text-align:center; }
</style>
</head>
<body>
<div class="bulletin">

    <div class="header">
        <div class="logo-left">
            <img src="{{ drapeau }}" alt="Drapeau RDC">
        </div>
        <div class="header-text">
            <h1>RÉPUBLIQUE DÉMOCRATIQUE DU CONGO</h1>
            <h2>MINISTÈRE DE L’ENSEIGNEMENT PRIMAIRE, SECONDAIRE ET PROFESSIONNEL</h2>
            <h3>ÉCOLE : {{ school.nom }} — Année scolaire : {{ school.annee_scolaire }}</h3>
            <h4>Classe : {{ classe.nom }}</h4>
            <h4>Élève : {{ eleve.nom }}</h4>
        </div>
        <div class="logo-right">
            <img src="{{ sceau }}" alt="Sceau">
        </div>
    </div>    

    <div class="info">
      <div>ÉCOLE : {{ school.nom }}</div>
      <div>ÉLÈVE : {{ eleve.nom }} SEXE : {{ eleve.sexe|default:"-" }}</div>
      <div>VILLE : {{ eleve.city.nom|default:"-" }}</div>
      <div>NÉ(E) À : {{ eleve.lieu_naissance|default:"-" }} le {{ eleve.date_naissance|date:"d/m/Y" }}</div>
      <div>COMMUNE/TER : {{ eleve.commune.nom|default:"-" }}</div>
      <div>CLASSE : {{ classe.nom }}</div>
      <div>CODE : [ _ _ _ _ _ _ ]</div>
      <div>N° PERM. : [ _ _ _ _ _ _ ]</div>
    </div>

    <h3 class="center">BULLETIN DE — ANNÉE SCOLAIRE {{ school.annee_scolaire }}</h3>
    
    <table>
        <tr>
          <th rowspan="2">BRANCHES</th>
          {% for semestre in semestres %}
            <th colspan="{{ periodes_par_semestre|get_item:semestre|length|add:'1' }}">{{ semestre.nom }}</th>
          {% endfor %}
          <th rowspan="2">TOT GÉN</th>
          <th rowspan="2">% EXAMEN DE REPÊCHAGE</th>
          <th rowspan="2">Sign. Prof</th>
        </tr>
        <tr>
          {% for semestre in semestres %}
            {% for p in periodes_par_semestre|get_item:semestre %}
              <th>{{ p.nom }}</th>
            {% endfor %}
            <th>Tot Sem</th>
          {% endfor %}
        </tr>
      
        <!-- MAXIMA PAR PÉRIODE -->
        <tr class="section-title">
          <td>MAXIMA</td>
          {% for semestre in semestres %}
            {% for p in periodes_par_semestre|get_item:semestre %}
              <td>{{ maxima_by_periode|get_item:p|default:"-" }}</td>
            {% endfor %}
            <td>{{ totaux_semestre|get_item:semestre|floatformat:2 }}</td>
          {% endfor %}
          <td>{{ total_general_attendu|floatformat:2 }}</td>
          <td>—</td>
          <td>—</td>
        </tr>
      
        <!-- MAXIMAS GÉNÉRAUX (au-dessus des totaux obtenus) -->
        <tr class="section-title">
          <td>MAXIMAS GÉNÉRAUX</td>
          {% for semestre in semestres %}
            {% for p in periodes_par_semestre|get_item:semestre %}
              <td>{{ maxima_generaux|get_item:p|default:"-" }}</td>
            {% endfor %}
            <td>{{ total_maxima_generaux_par_semestre|get_item:semestre|floatformat:2 }}</td>
          {% endfor %}
          <td>{{ total_maxima_general|floatformat:2 }}</td>
          <td>—</td>
          <td>—</td>
        </tr>
      
        <!-- MATIERES -->
        {% for matiere in matieres %}
        <tr>
          <td>{{ matiere.nom }}</td>
          {% for semestre in semestres %}
            {% for p in periodes_par_semestre|get_item:semestre %}
              <td>
                {% with notes_by_matiere|get_item:matiere|get_item:p as note %}
                  {{ note.note_obtenue|default:"-" }}
                {% endwith %}
              </td>
            {% endfor %}
            <td>{{ tot_matieres_semestre|get_item:matiere|get_item:semestre|floatformat:2 }}</td>
          {% endfor %}
          <td>{{ tot_matieres_global|get_item:matiere|floatformat:2 }}</td>
          <td>—</td>
          <td>—</td>
        </tr>
        {% endfor %}
      
        <!-- TOTAUX OBTENUS -->
        <tr class="section-title">
          <td>TOTAUX OBTENUS</td>
          {% for semestre in semestres %}
            {% for p in periodes_par_semestre|get_item:semestre %}
              <td>{{ total_periode_obtenu|get_item:p|floatformat:2 }}</td>
            {% endfor %}
            <td>{{ total_semestre_obtenu|get_item:semestre|floatformat:2 }}</td>
          {% endfor %}
          <td>{{ total_obtenu|floatformat:2 }}</td>
          <td>—</td>
          <td>—</td>
        </tr>
      
        <!-- POURCENTAGE -->
        <tr class="section-title">
          <td>POURCENTAGE</td>
          {% for semestre in semestres %}
            {% for p in periodes_par_semestre|get_item:semestre %}
              <td>{{ pourcentage_periode|get_item:p|floatformat:2 }}%</td>
            {% endfor %}
            <td>{{ pourcentage_semestre|get_item:semestre|floatformat:2 }}%</td>
          {% endfor %}
          <td>{{ pourcentage_total|floatformat:2 }}%</td>
          <td>—</td>
          <td>—</td>
        </tr>
      
        <!-- RANG -->
        <tr class="section-title">
          <td>PLACE / NBRE D'ÉLÈVES</td>
          {% for semestre in semestres %}
            {% for p in periodes_par_semestre|get_item:semestre %}
              <td>{{ rang_par_periode|get_item:p|default:"—" }}</td>
            {% endfor %}
            <td>{{ rang_par_semestre|get_item:semestre|default:"—" }}</td>
          {% endfor %}
          <td>{{ rang_general|default:"—" }}</td>
          <td>—</td>
          <td>—</td>
        </tr>
      </table>
      

    <div class="signatures">
      <div class="signature-box">
        Signature de l’élève <br><br> __________________
      </div>
      <div class="signature-box">
        Sceau de l’école
      </div>
      <div class="signature-box">
        Le Chef d’établissement <br><br> __________________
      </div>
    </div>

    <div class="note">
      * L’élève passe dans la classe supérieure si la moyenne générale est ≥ 50 %. <br>
      * L’élève ne pourra passer dans la classe supérieure s’il n’a subi un examen de repêchage. <br>
      * Ce bulletin est sans valeur s’il est raturé ou surchargé. <br>
      <br>
      Fait à .................................................., le ...... / ...... / 20.....
    </div>

</div>
</body>
</html> {% endcomment %}


{% comment %} {% load custom_tags %}
{% load static %}
<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Bulletin de {{ eleve.nom }}</title>
<style>
  /* Corps de la page */
  body {
    font-family: "Times New Roman", serif;
    background: #fff;
    color: #000;
    margin: 0;
    padding: 0;
  }

  /* Bulletin centré et adapté A4 */
  .bulletin {
    width: 190mm; /* A4 portrait = 210mm - 20mm marge */
    margin: 10mm auto;
    border: 2px solid #000;
    padding: 5mm;
    box-sizing: border-box;
  }

  /* Header avec images et texte */
  .header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-bottom: 2px solid #000;
    padding-bottom: 4px;
    margin-bottom: 5mm;
  }
  .header .logo-left,
  .header .logo-right {
    width: 30mm;
  }
  .header .logo-left img,
  .header .logo-right img {
    max-height: 25mm;
    display: block;
    margin: 0 auto;
  }
  .header .header-text {
    flex: 1;
    text-align: center;
    font-size: 12px;
  }
  .header .header-text h1, .header .header-text h2, .header .header-text h3, .header .header-text h4 {
    margin: 2px 0;
  }

  /* Infos élève */
  .info {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 2mm;
    font-size: 11px;
    margin-bottom: 5mm;
  }

  /* Tableau */
  table {
    border-collapse: collapse;
    width: 100%;
    font-size: 10px;
    text-align: center;
    table-layout: fixed;
  }
  th, td {
    border: 1px solid #000;
    padding: 1mm;
    word-wrap: break-word;
  }
  th {
    background: #eee;
    font-weight: bold;
  }
  .section-title {
    font-weight: bold;
    background: #f5f5f5;
    text-align: left;
  }

  /* Signatures */
  .signatures {
    display: flex;
    justify-content: space-between;
    margin-top: 8mm;
    font-size: 10px;
  }
  .signature-box {
    width: 30%;
    text-align: center;
  }

  /* Notes */
  .note {
    font-size: 9px;
    margin-top: 5mm;
  }

  /* Titres centrés */
  .center {
    text-align: center;
  }
</style>
</head>
<body>
<div class="bulletin">

    <div class="header" style="display:flex; justify-content:space-between; align-items:center; border-bottom:2px solid #000; padding-bottom:4px;">
        <!-- Image à gauche -->
        <div class="logo-left">
            <img src="{{ drapeau }}" alt="Drapeau RDC" style="height:60px;">
        </div>
    
        <!-- Texte centré -->
        <div class="header-text" style="text-align:center; flex:1; margin:0 10px;">
            <h1>RÉPUBLIQUE DÉMOCRATIQUE DU CONGO</h1>
            <h2>MINISTÈRE DE L’ENSEIGNEMENT PRIMAIRE, SECONDAIRE ET PROFESSIONNEL</h2>
            <h3>ÉCOLE : {% if school %}{{ school.nom }}{% endif %} — Année scolaire : {% if school %}{{ school.annee_scolaire }}{% endif %}</h3>
            <h4>Classe : {{ classe.nom }}</h4>
            <h4>Élève : {{ eleve.nom }}</h4>
        </div>
    
        <!-- Image à droite -->
        <div class="logo-right">
            <img src="{{ sceau }}" alt="Sceau" style="height:60px;">
        </div>
    </div>    
    

    <div class="info">
      <div>ÉCOLE : {% if school %}{{ school.nom }}{% endif %}</div>
      <div>ÉLÈVE : {{ eleve.nom }} SEXE : {{ eleve.sexe|default:"-" }}</div>
      <div>VILLE : {{ eleve.city.nom|default:"-" }}</div>
      <div>NÉ(E) À : {{ eleve.lieu_naissance|default:"-" }} le {{ eleve.date_naissance|date:"d/m/Y" }}</div>
      <div>COMMUNE/TER : {{ eleve.commune.nom|default:"-" }}</div>
      <div>CLASSE : {{ classe.nom }}</div>
      <div>CODE : [ _ _ _ _ _ _ ]</div>
      <div>N° PERM. : [ _ _ _ _ _ _ ]</div>
    </div>

    <h3 class="center">BULLETIN DE — ANNÉE SCOLAIRE {% if school %}{{ school.annee_scolaire }}{% endif %}</h3>
    
    <table>
      <!-- Header Semestres et Périodes -->
      <tr>
        <th rowspan="2">BRANCHES</th>
        {% for semestre in semestres %}
          <th colspan="{{ periodes_par_semestre|get_item:semestre.id|length|add:'1' }}">{{ semestre.nom }}</th>
        {% endfor %}
        <th rowspan="2">TOT GÉN</th>
        <th rowspan="2">% EXAMEN DE REPÊCHAGE</th>
        <th rowspan="2">Sign. Prof</th>
      </tr>
      <tr>
        {% for semestre in semestres %}
          {% for p in periodes_par_semestre|get_item:semestre.id %}
            <th>{{ p.nom }}</th>
          {% endfor %}
          <th>Tot Sem</th>
        {% endfor %}
      </tr>

      <!-- MAXIMA -->
      <tr class="section-title">
        <td>MAXIMA</td>
        {% for semestre in semestres %}
          {% for p in periodes_par_semestre|get_item:semestre.id %}
            <td>{{ maxima_by_periode|get_item:p.id|default:"-" }}</td>
          {% endfor %}
          <td>{{ totaux_semestre|get_item:semestre.id|floatformat:2 }}</td>
        {% endfor %}
        <td>{{ total_general_attendu|floatformat:2 }}</td>
        <td>—</td>
        <td>—</td>
      </tr>

      <!-- Matières -->
      {% for matiere in matieres %}
      <tr>
        <td>{{ matiere.nom }}</td>
        {% for semestre in semestres %}
          {% for p in periodes_par_semestre|get_item:semestre.id %}
            <td>{% with notes_by_matiere|get_item:matiere.id|get_item:p.id as note %}{{ note.note_obtenue|default:"-" }}{% endwith %}</td>
          {% endfor %}
          <td>{{ tot_matieres_semestre|get_item:matiere.id|get_item:semestre.id|floatformat:2 }}</td>
        {% endfor %}
        <td>{{ tot_matieres_global|get_item:matiere.id|floatformat:2 }}</td>
        <td>—</td>
        <td>—</td>
      </tr>
      {% endfor %}

      <!-- Totaux -->
      <tr class="section-title">
        <td>TOTAUX OBTENUS</td>
        {% for semestre in semestres %}
          {% for p in periodes_par_semestre|get_item:semestre.id %}
            <td>{{ total_periode_obtenu|get_item:p.id|floatformat:2 }}</td>
          {% endfor %}
          <td>{{ total_semestre_obtenu|get_item:semestre.id|floatformat:2 }}</td>
        {% endfor %}
        <td>{{ total_obtenu|floatformat:2 }}</td>
        <td>—</td>
        <td>—</td>
      </tr>

      <!-- Pourcentage -->
      <tr class="section-title">
        <td>POURCENTAGE</td>
        {% for semestre in semestres %}
          {% for p in periodes_par_semestre|get_item:semestre.id %}
            <td>{{ pourcentage_periode|get_item:p.id|floatformat:2 }}%</td>
          {% endfor %}
          <td>{{ pourcentage_semestre|get_item:semestre.id|floatformat:2 }}%</td>
        {% endfor %}
        <td>{{ pourcentage_total|floatformat:2 }}%</td>
        <td>—</td>
        <td>—</td>
      </tr>

      <!-- Rang -->
      <tr class="section-title">
        <td>PLACE / NBRE D'ÉLÈVES</td>
        {% for semestre in semestres %}
          {% for p in periodes_par_semestre|get_item:semestre.id %}
            <td>{{ rang_par_periode|get_item:p.id|default:"—" }}</td>
          {% endfor %}
          <td>{{ rang_par_semestre|get_item:semestre.id|default:"—" }}</td>
        {% endfor %}
        <td>{{ rang_general|default:"—" }}</td>
        <td>—</td>
        <td>—</td>
      </tr>
    </table>

    <div class="signatures">
      <div class="signature-box">
        Signature de l’élève <br><br> __________________
      </div>
      <div class="signature-box">
        Sceau de l’école
      </div>
      <div class="signature-box">
        Le Chef d’établissement <br><br> __________________
      </div>
    </div>

    <div class="note">
      * L’élève passe dans la classe supérieure si la moyenne générale est ≥ 50 %. <br>
      * L’élève ne pourra passer dans la classe supérieure s’il n’a subi un examen de repêchage. <br>
      * Ce bulletin est sans valeur s’il est raturé ou surchargé. <br>
      <br>
      Fait à .................................................., le ...... / ...... / 20.....
    </div>

</div>
</body>
</html>  {% endcomment %}


{% comment %} {% load custom_tags %}
{% load static %}
<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Bulletin de {{ eleve.nom }}</title>
<style>
  body { font-family: "Times New Roman", serif; background: #fff; margin: 20px; color: #000; }
  .bulletin { width: 1024px; margin: auto; border: 2px solid #000; padding: 8px; }
  .header { text-align: center; border-bottom: 2px solid #000; padding-bottom: 4px; }
  .header h1, .header h2, .header h3, .header h4 { margin: 2px 0; font-size: 14px; }
  .info { display: grid; grid-template-columns: repeat(2, 1fr); gap: 4px; font-size: 13px; margin-top: 5px; }
  table { border-collapse: collapse; width: 100%; margin-top: 8px; font-size: 12px; text-align: center; }
  th, td { border: 1px solid #000; padding: 3px; }
  th { background: #eee; font-weight: bold; }
  .section-title { font-weight: bold; background: #f5f5f5; text-align: left; }
  .signatures { display: flex; justify-content: space-between; margin-top: 15px; font-size: 12px; }
  .signature-box { width: 30%; text-align: center; }
  .note { font-size: 11px; margin-top: 10px; }
  .center { text-align: center; }
  .small { font-size: 11px; }
  @media print { body { margin: 0; } }
</style>
</head>
<body>
<div class="bulletin">

    <div class="header" style="display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid #000; padding-bottom: 4px;">
        <!-- Image à gauche -->
        <div>
            <img src="{% static 'img/drc.jpg' %}" alt="Drapeau RDC" style="height: 60px;">
        </div>
    
        <!-- Texte centré -->
        <div style="text-align: center; flex: 1; margin: 0 10px;">
            <h1>RÉPUBLIQUE DÉMOCRATIQUE DU CONGO</h1>
            <h2>MINISTÈRE DE L’ENSEIGNEMENT PRIMAIRE, SECONDAIRE ET PROFESSIONNEL</h2>
            <h3>ÉCOLE : {% if school %}{{ school.nom }}{% endif %} — Année scolaire : {% if school %}{{ school.annee_scolaire }}{% endif %}</h3>
            <h4>Classe : {{ classe.nom }}</h4>
            <h4>Élève : {{ eleve.nom }}</h4>
        </div>
    
        <!-- Image à droite -->
        <div>
            <img src="{% static 'img/sceau_pays.png' %}" alt="Sceau" style="height: 60px;">
        </div>
    </div>
    

  <div class="top-line"><b>N° ID :</b> __________________________</div>

  <div class="info">
    <div>ÉCOLE : {% if school %}{{ school.nom }}{% endif %}</div>
    <div>ÉLÈVE : {{ eleve.nom }} SEXE : {{ eleve.sexe|default:"-" }}</div>
    <div>VILLE : {{ eleve.city.nom|default:"-" }}</div>
    <div>NÉ(E) À : {{ eleve.lieu_naissance|default:"-" }} le {{ eleve.date_naissance|date:"d/m/Y" }}</div>
    <div>COMMUNE/TER : {{ eleve.commune.nom|default:"-" }}</div>
    <div>CLASSE : {{ classe.nom }}</div>
    <div>CODE : [ _ _ _ _ _ _ ]</div>
    <div>N° PERM. : [ _ _ _ _ _ _ ]</div>
  </div>

  <h3 class="center" style="margin-top:10px;">BULLETIN — ANNÉE SCOLAIRE {% if school %}{{ school.annee_scolaire }}{% endif %}</h3>

  <table>
    <!-- Header Semestres et Périodes -->
    <tr>
      <th rowspan="2">BRANCHES</th>
      {% for semestre in semestres %}
        <th colspan="{{ periodes_par_semestre|get_item:semestre.id|length|add:"1" }}">{{ semestre.nom }}</th>
      {% endfor %}
      <th rowspan="2">TOT GÉN</th>
      <th rowspan="2">% EXAMEN DE REPÊCHAGE</th>
      <th rowspan="2">Sign. Prof</th>
    </tr>

    <!-- Ligne des périodes -->
    <tr>
      {% for semestre in semestres %}
        {% for p in periodes_par_semestre|get_item:semestre.id %}
          <th>{{ p.nom }}</th>
        {% endfor %}
        <th>Tot Sem</th>
      {% endfor %}
    </tr>

    <!-- MAXIMA -->
    <tr class="section-title">
      <td>MAXIMA</td>
      {% for semestre in semestres %}
        {% for p in periodes_par_semestre|get_item:semestre.id %}
          <td>{{ maxima_by_periode|get_item:p.id|default:"-" }}</td>
        {% endfor %}
        <td>{{ totaux_semestre|get_item:semestre.id|floatformat:2 }}</td>
      {% endfor %}
      <td>{{ total_general_attendu|floatformat:2 }}</td>
      <td>—</td>
      <td>—</td>
    </tr>

    <!-- Matières -->
    {% for matiere in matieres %}
      <tr>
        <td>{{ matiere.nom }}</td>
        {% for semestre in semestres %}
          {% for p in periodes_par_semestre|get_item:semestre.id %}
            <td>
              {% with notes_by_matiere|get_item:matiere.id|get_item:p.id as note %}
                {{ note.note_obtenue|default:"-" }}
              {% endwith %}
            </td>
          {% endfor %}
          <td>{{ tot_matieres_semestre|get_item:matiere.id|get_item:semestre.id|floatformat:2 }}</td>
        {% endfor %}
        <td>{{ tot_matieres_global|get_item:matiere.id|floatformat:2 }}</td>
        <td>—</td>
        <td>—</td>
      </tr>
    {% endfor %}

    <!-- TOTAUX OBTENUS -->
    <tr class="section-title">
      <td>TOTAUX OBTENUS</td>
      {% for semestre in semestres %}
        {% for p in periodes_par_semestre|get_item:semestre.id %}
          <td>{{ total_periode_obtenu|get_item:p.id|floatformat:2 }}</td>
        {% endfor %}
        <td>{{ total_semestre_obtenu|get_item:semestre.id|floatformat:2 }}</td>
      {% endfor %}
      <td>{{ total_obtenu|floatformat:2 }}</td>
      <td>—</td>
      <td>—</td>
    </tr>

    <!-- POURCENTAGE -->
    <tr class="section-title">
      <td>POURCENTAGE</td>
      {% for semestre in semestres %}
        {% for p in periodes_par_semestre|get_item:semestre.id %}
          <td>{{ pourcentage_periode|get_item:p.id|floatformat:2 }}%</td>
        {% endfor %}
        <td>{{ pourcentage_semestre|get_item:semestre.id|floatformat:2 }}%</td>
      {% endfor %}
      <td>{{ pourcentage_total|floatformat:2 }}%</td>
      <td>—</td>
      <td>—</td>
    </tr>

    <!-- PLACE / NBRE D'ÉLÈVES -->
    <tr class="section-title">
      <td>PLACE / NBRE D'ÉLÈVES</td>
      {% for semestre in semestres %}
        {% for p in periodes_par_semestre|get_item:semestre.id %}
          <td>{{ rang_par_periode|get_item:p.id|default:"—" }}</td>
        {% endfor %}
        <td>{{ rang_par_semestre|get_item:semestre.id|default:"—" }}</td>
      {% endfor %}
      <td>{{ rang_general|default:"—" }}</td>
      <td>—</td>
      <td>—</td>
    </tr>
  </table>

  <div class="signatures">
    <div class="signature-box">
      Signature de l’élève <br><br> __________________
    </div>
    <div class="signature-box">
      Sceau de l’école
    </div>
    <div class="signature-box">
      Le Chef d’établissement <br><br> __________________
    </div>
  </div>

  <div class="note">
    * L’élève passe dans la classe supérieure si la moyenne générale est ≥ 50 %. <br>
    * L’élève ne pourra passer dans la classe supérieure s’il n’a subi un examen de repêchage. <br>
    * Ce bulletin est sans valeur s’il est raturé ou surchargé. <br>
    <br>
    Fait à .................................................., le ...... / ...... / 20.....
  </div>
</div>
</body>
</html> {% endcomment %}


{% comment %} {% load custom_tags %}
<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Bulletin de {{ eleve.nom }}</title>
<style>
  body {
    font-family: "Times New Roman", serif;
    background: #fff;
    margin: 20px;
    color: #000;
  }

  .bulletin {
    width: 1024px;
    margin: auto;
    border: 2px solid #000;
    padding: 8px;
  }

  .header {
    text-align: center;
    border-bottom: 2px solid #000;
    padding-bottom: 4px;
  }

  .header h1, .header h2, .header h3, .header h4 {
    margin: 2px 0;
    font-size: 14px;
  }

  .info {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 4px;
    font-size: 13px;
    margin-top: 5px;
  }

  table {
    border-collapse: collapse;
    width: 100%;
    margin-top: 8px;
    font-size: 12px;
    text-align: center;
  }

  th, td {
    border: 1px solid #000;
    padding: 3px;
  }

  th {
    background: #eee;
    font-weight: bold;
  }

  .section-title {
    font-weight: bold;
    background: #f5f5f5;
    text-align: left;
  }

  .signatures {
    display: flex;
    justify-content: space-between;
    margin-top: 15px;
    font-size: 12px;
  }

  .signature-box {
    width: 30%;
    text-align: center;
  }

  .note {
    font-size: 11px;
    margin-top: 10px;
  }

  .center {
    text-align: center;
  }

  .small {
    font-size: 11px;
  }

  @media print {
    body {
      margin: 0;
    }
  }
</style>
</head>
<body>
<div class="bulletin">

  <div class="header">
    <h1>RÉPUBLIQUE DÉMOCRATIQUE DU CONGO</h1>
    <h2>MINISTÈRE DE L’ENSEIGNEMENT PRIMAIRE, SECONDAIRE ET PROFESSIONNEL</h2>
    <h3>ÉCOLE : {% if school %}{{ school.nom }}{% endif %} — Année scolaire : {% if school %}{{ school.annee_scolaire }}{% endif %}</h3>
    <h4>Classe : {{ classe.nom }}</h4>
    <h4>Élève : {{ eleve.nom }}</h4>
  </div>

  <div class="top-line"><b>N° ID :</b> __________________________</div>

  <div class="info">
    <div>ÉCOLE : {% if school %}{{ school.nom }}{% endif %}</div>
    <div>ÉLÈVE : {{ eleve.nom }} SEXE : {{ eleve.sexe|default:"-" }}</div>
    <div>VILLE : {{ eleve.city.nom|default:"-" }}</div>
    <div>NÉ(E) À : {{ eleve.lieu_naissance|default:"-" }} le {{ eleve.date_naissance|date:"d/m/Y" }}</div>
    <div>COMMUNE/TER : {{ eleve.commune.nom|default:"-" }}</div>
    <div>CLASSE : {{ classe.nom }}</div>
    <div>CODE : [ _ _ _ _ _ _ ]</div>
    <div>N° PERM. : [ _ _ _ _ _ _ ]</div>
  </div>

  <h3 class="center" style="margin-top:10px;">BULLETIN — ANNÉE SCOLAIRE {% if school %}{{ school.annee_scolaire }}{% endif %}</h3>

  <table>
    <!-- Header Semestres et Périodes -->
    <tr>
      <th rowspan="2">BRANCHES</th>
      {% for semestre in semestres %}
        <th colspan="{{ periodes_par_semestre|get_item:semestre|length|add:"1" }}">{{ semestre.nom }}</th>
      {% endfor %}
      <th rowspan="2">TOT GÉN</th>
      <th rowspan="2">% EXAMEN DE REPÊCHAGE</th>
      <th rowspan="2">Sign. Prof</th>
    </tr>

    <!-- Ligne des périodes -->
    <tr>
      {% for semestre in semestres %}
        {% for p in periodes_par_semestre|get_item:semestre %}
          <th>{{ p.nom }}</th>
        {% endfor %}
        <th>Tot Sem</th>
      {% endfor %}
    </tr>

    <!-- MAXIMA -->
    <tr class="section-title">
      <td>MAXIMA</td>
      {% for semestre in semestres %}
        {% for p in periodes_par_semestre|get_item:semestre %}
          <td>{{ maxima_by_periode|get_item:p|default:"-" }}</td>
        {% endfor %}
        <td>{{ totaux_semestre|get_item:semestre|floatformat:2 }}</td>
      {% endfor %}
      <td>{{ total_general_attendu|floatformat:2 }}</td>
      <td>—</td>
      <td>—</td>
    </tr>

    <!-- Matières -->
    {% for matiere in matieres %}
      <tr>
        <td>{{ matiere.nom }}</td>
        {% for semestre in semestres %}
          {% for p in periodes_par_semestre|get_item:semestre %}
            <td>
              {% with notes_by_matiere|get_item:matiere|get_item:p as note %}
                {{ note.note_obtenue|default:"-" }}
              {% endwith %}
            </td>
          {% endfor %}
          <td>{{ tot_matieres_semestre|get_item:matiere|get_item:semestre|floatformat:2 }}</td>
        {% endfor %}
        <td>{{ tot_matieres_global|get_item:matiere|floatformat:2 }}</td>
        <td>—</td>
        <td>—</td>
      </tr>
    {% endfor %}

    <!-- TOTAUX OBTENUS -->
    <tr class="section-title">
      <td>TOTAUX OBTENUS</td>
      {% for semestre in semestres %}
        {% for p in periodes_par_semestre|get_item:semestre %}
          <td>{{ total_periode_obtenu|get_item:p|floatformat:2 }}</td>
        {% endfor %}
        <td>{{ total_semestre_obtenu|get_item:semestre|floatformat:2 }}</td>
      {% endfor %}
      <td>{{ total_obtenu|floatformat:2 }}</td>
      <td>—</td>
      <td>—</td>
    </tr>

    <!-- POURCENTAGE -->
    <tr class="section-title">
      <td>POURCENTAGE</td>
      {% for semestre in semestres %}
        {% for p in periodes_par_semestre|get_item:semestre %}
          <td>{{ pourcentage_periode|get_item:p|floatformat:2 }}%</td>
        {% endfor %}
        <td>{{ pourcentage_semestre|get_item:semestre|floatformat:2 }}%</td>
      {% endfor %}
      <td>{{ pourcentage_total|floatformat:2 }}%</td>
      <td>—</td>
      <td>—</td>
    </tr>

    <!-- PLACE / NBRE D'ÉLÈVES -->
    <tr class="section-title">
      <td>PLACE / NBRE D'ÉLÈVES</td>
      {% for semestre in semestres %}
        {% for p in periodes_par_semestre|get_item:semestre %}
          <td>{{ rang_par_periode|get_item:p|default:"—" }}</td>
        {% endfor %}
        <td>{{ rang_par_semestre|get_item:semestre|default:"—" }}</td>
      {% endfor %}
      <td>{{ rang_general|default:"—" }}</td>
      <td>—</td>
      <td>—</td>
    </tr>
  </table>

  <div class="signatures">
    <div class="signature-box">
      Signature de l’élève <br><br> __________________
    </div>
    <div class="signature-box">
      Sceau de l’école
    </div>
    <div class="signature-box">
      Le Chef d’établissement <br><br> __________________
    </div>
  </div>

  <div class="note">
    * L’élève passe dans la classe supérieure si la moyenne générale est ≥ 50 %. <br>
    * L’élève ne pourra passer dans la classe supérieure s’il n’a subi un examen de repêchage. <br>
    * Ce bulletin est sans valeur s’il est raturé ou surchargé. <br>
    <br>
    Fait à .................................................., le ...... / ...... / 20.....
  </div>
</div>
</body>
</html> {% endcomment %}


{% comment %} {% load custom_tags %}
<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Bulletin de {{ eleve.nom }}</title>
<style>
  body {
    font-family: "Times New Roman", serif;
    background: #fff;
    margin: 20px;
    color: #000;
  }

  .bulletin {
    width: 1024px;
    margin: auto;
    border: 2px solid #000;
    padding: 8px;
  }

  .header {
    text-align: center;
    border-bottom: 2px solid #000;
    padding-bottom: 4px;
  }

  .header h1, .header h2, .header h3, .header h4 {
    margin: 2px 0;
    font-size: 14px;
  }

  .info {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 4px;
    font-size: 13px;
    margin-top: 5px;
  }

  table {
    border-collapse: collapse;
    width: 100%;
    margin-top: 8px;
    font-size: 12px;
    text-align: center;
  }

  th, td {
    border: 1px solid #000;
    padding: 3px;
  }

  th {
    background: #eee;
    font-weight: bold;
  }

  .section-title {
    font-weight: bold;
    background: #f5f5f5;
    text-align: left;
  }

  .signatures {
    display: flex;
    justify-content: space-between;
    margin-top: 15px;
    font-size: 12px;
  }

  .signature-box {
    width: 30%;
    text-align: center;
  }

  .note {
    font-size: 11px;
    margin-top: 10px;
  }

  .center {
    text-align: center;
  }

  .small {
    font-size: 11px;
  }

  @media print {
    body {
      margin: 0;
    }
  }
</style>
</head>
<body>
<div class="bulletin">
  <div class="header">
    <h1>RÉPUBLIQUE DÉMOCRATIQUE DU CONGO</h1>
    <h2>MINISTÈRE DE L’ENSEIGNEMENT PRIMAIRE, SECONDAIRE ET PROFESSIONNEL</h2>
    <h3>ÉCOLE : {% if school %}{{ school.nom }}{% endif %} — Année scolaire : {% if school %}{{ school.annee_scolaire }}{% endif %}</h3>
    <h4>Classe : {{ classe.nom }}</h4>
    <h4>Élève : {{ eleve.nom }}</h4>
  </div>

  <div class="top-line"><b>N° ID :</b> __________________________</div>

  <div class="info">
    <div>ÉCOLE : {% if school %}{{ school.nom }}{% endif %}</div>
    <div>ÉLÈVE : {{ eleve.nom }} SEXE : {{ eleve.sexe|default:"-" }}</div>
    <div>VILLE : {{ eleve.city.nom|default:"-" }}</div>
    <div>NÉ(E) À : {{ eleve.lieu_naissance|default:"-" }} le {{ eleve.date_naissance|date:"d/m/Y" }}</div>
    <div>COMMUNE/TER : {{ eleve.commune.nom|default:"-" }}</div>
    <div>CLASSE : {{ classe.nom }}</div>
    <div>CODE : [ _ _ _ _ _ _ ]</div>
    <div>N° PERM. : [ _ _ _ _ _ _ ]</div>
  </div>

  <h3 class="center" style="margin-top:10px;">BULLETIN — ANNÉE SCOLAIRE {% if school %}{{ school.annee_scolaire }}{% endif %}</h3>

  <table>
    <!-- Header Semestres et Périodes -->
    <tr>
      <th rowspan="2">BRANCHES</th>
      {% for semestre in semestres %}
        <th colspan="{{ periodes_par_semestre|get_item:semestre|length + 1 }}">{{ semestre.nom }}</th>
      {% endfor %}
      <th rowspan="2">TOT GÉN</th>
      <th rowspan="2">% EXAMEN DE REPÊCHAGE</th>
      <th rowspan="2">Sign. Prof</th>
    </tr>
  
    <!-- Ligne Périodes -->
    <tr>
      {% for semestre in semestres %}
        {% for p in periodes_par_semestre|get_item:semestre %}
          <th>{{ p.nom }}</th>
        {% endfor %}
        <th>Tot Sem</th>
      {% endfor %}
    </tr>
  
    <!-- MAXIMA -->
    <tr class="section-title">
      <td>MAXIMA</td>
      {% for semestre in semestres %}
        {% for p in periodes_par_semestre|get_item:semestre %}
          <td>{{ maxima_by_periode|get_item:p|default:"-" }}</td>
        {% endfor %}
        <td>{{ totaux_semestre|get_item:semestre|floatformat:2 }}</td>
      {% endfor %}
      <td>{{ total_general_attendu|floatformat:2 }}</td>
      <td>—</td>
      <td>—</td>
    </tr>
  
    <!-- Matières -->
    {% for matiere in matieres %}
      <tr>
        <td>{{ matiere.nom }}</td>
        {% for semestre in semestres %}
          {% for p in periodes_par_semestre|get_item:semestre %}
            <td>
              {% with notes_by_matiere|get_item:matiere|get_item:p as note %}
                {{ note.note_obtenue|default:"-" }}
              {% endwith %}
            </td>
          {% endfor %}
          <td>{{ tot_matieres_semestre|get_item:matiere|get_item:semestre|floatformat:2 }}</td>
        {% endfor %}
        <td>{{ tot_matieres_global|get_item:matiere|floatformat:2 }}</td>
        <td>—</td>
        <td>—</td>
      </tr>
    {% endfor %}
  
    <!-- TOTAUX OBTENUS -->
    <tr class="section-title">
      <td>TOTAUX OBTENUS</td>
      {% for semestre in semestres %}
        {% for p in periodes_par_semestre|get_item:semestre %}
          <td>{{ total_periode_obtenu|get_item:p|floatformat:2 }}</td>
        {% endfor %}
        <td>{{ total_semestre_obtenu|get_item:semestre|floatformat:2 }}</td>
      {% endfor %}
      <td>{{ total_obtenu|floatformat:2 }}</td>
      <td>—</td>
      <td>—</td>
    </tr>
  
    <!-- POURCENTAGE -->
    <tr class="section-title">
      <td>POURCENTAGE</td>
      {% for semestre in semestres %}
        {% for p in periodes_par_semestre|get_item:semestre %}
          <td>{{ pourcentage_periode|get_item:p|floatformat:2 }}%</td>
        {% endfor %}
        <td>{{ pourcentage_semestre|get_item:semestre|floatformat:2 }}%</td>
      {% endfor %}
      <td>{{ pourcentage_total|floatformat:2 }}%</td>
      <td>—</td>
      <td>—</td>
    </tr>
  
    <!-- PLACE / NBRE D'ÉLÈVES -->
    <tr class="section-title">
      <td>PLACE / NBRE D'ÉLÈVES</td>
      {% for semestre in semestres %}
        {% for p in periodes_par_semestre|get_item:semestre %}
          <td>{{ rang_par_periode|get_item:p|default:"—" }}</td>
        {% endfor %}
        <td>{{ rang_par_semestre|get_item:semestre|default:"—" }}</td>
      {% endfor %}
      <td>{{ rang_general|default:"—" }}</td>
      <td>—</td>
      <td>—</td>
    </tr>
  </table>
  
  

  <div class="signatures">
    <div class="signature-box">
      Signature de l’élève <br><br> __________________
    </div>
    <div class="signature-box">
      Sceau de l’école
    </div>
    <div class="signature-box">
      Le Chef d’établissement <br><br> __________________
    </div>
  </div>

  <div class="note">
    * L’élève passe dans la classe supérieure si la moyenne générale est ≥ 50 %. <br>
    * L’élève ne pourra passer dans la classe supérieure s’il n’a subi un examen de repêchage. <br>
    * Ce bulletin est sans valeur s’il est raturé ou surchargé. <br>
    <br>
    Fait à .................................................., le ...... / ...... / 20.....
  </div>
</div>
</body>
</html>
 {% endcomment %}
